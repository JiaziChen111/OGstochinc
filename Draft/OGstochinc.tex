\documentclass[letterpaper,12pt]{article}

\usepackage{threeparttable}
\usepackage{geometry}
\geometry{letterpaper,tmargin=1in,bmargin=1in,lmargin=1.25in,rmargin=1.25in}
\usepackage[format=hang,font=normalsize,labelfont=bf]{caption}
\usepackage{amsmath}
\usepackage{multirow}
\usepackage{array}
\usepackage{delarray}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{lscape}
\usepackage{natbib}
\usepackage{setspace}
\usepackage{float,color}
\usepackage[pdftex]{graphicx}
\usepackage{pdfsync}
\usepackage{verbatim}
\usepackage{placeins}
\usepackage{geometry}
\usepackage{pdflscape}
\synctex=1
\usepackage{hyperref}
\hypersetup{colorlinks,linkcolor=red,urlcolor=blue,citecolor=red}
\usepackage{bm}

\theoremstyle{definition}
\newtheorem{theorem}{Theorem}
\newtheorem{acknowledgement}[theorem]{Acknowledgement}
\newtheorem{algorithm}[theorem]{Algorithm}
\newtheorem{axiom}[theorem]{Axiom}
\newtheorem{case}[theorem]{Case}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{conclusion}[theorem]{Conclusion}
\newtheorem{condition}[theorem]{Condition}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{criterion}[theorem]{Criterion}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{derivation}{Derivation} % Number derivations on their own
\newtheorem{example}[theorem]{Example}
\newtheorem{exercise}{Exercise} % Number exercises on their own
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{notation}[theorem]{Notation}
\newtheorem{problem}[theorem]{Problem}
\newtheorem{proposition}{Proposition} % Number propositions on their own
\newtheorem{remark}[theorem]{Remark}
\newtheorem{solution}[theorem]{Solution}
\newtheorem{summary}[theorem]{Summary}
\numberwithin{equation}{section}
\numberwithin{exercise}{section}
\bibliographystyle{aer}
\providecommand{\abs}[1]{\lvert#1\rvert}
\providecommand{\norm}[1]{\lVert#1\rVert}
\newcommand{\ve}{\varepsilon}
\newcommand{\ip}[2]{\langle #1,#2 \rangle}


\begin{document}


\title{Overlapping Generations Buildup: \\
       Theory and Problems}
\date{July 2015\\
{\footnotesize{(version 2015.07.a)}}}
\author{}
\maketitle

\begin{spacing}{1.5}
\pagenumbering{arabic}


\section{Introduction}\label{SecIntro}

   The overlapping generations (OG) model was first proposed by \citet{Samuelson:1958}.\footnote{The most correct acronym for overlapping generations model is OG. However, these models have often also been referred to as OLG models.} It is an extremely useful economic model with heterogeneous agents, and its usefulness is manifest in two main characteristics. First, the agents are heterogeneous in terms of their ages, which seems to be an important difference in terms of economic decision making.\footnote{The savings decisions of 70-year-olds are very different from those of 20-year-olds.} In addition, overlapping generations models assume that the lifetime of an individual is finite and must eventually end. This is a reality for all of us, and seems very intuitive. However, infinitely lived agent models have become important in economics because they are actually more analytically tractable, and the decisions an agent makes if they live forever might be a good approximation of what an agent would choose if he expected to live for 40 more years. But OLG models are essential for answering questions about policies that affect age cohorts differently, the leading example of which is pension programs.

   This document will take you through successive iterations of OG models from the most simple 3-period-lived deterministic model with inelastic labor supply to an $S$-period-lived agent model with endogenous labor, a bequest motive, population dynamics, productivity growth, and taxes. All the models here will be deterministic in aggregate, but individuals will face mortality risk when we incorporate population dynamics. Eventually, although not in this document, we will include idiosyncratic stochastic income processes on individual ability. All along the way, we will build up these models with theory and computational exercises that you will complete.


\section{Principles of writing code in Python}\label{SecCodePrinc}

   \begin{itemize}
      \item Work with 1-dimensional numpy vectors as much as possible. For example, a vector $x$ with $n$ elements should have shape \texttt{x.shape = [n,]}.
      \item Write functions for particular lines of code that get reused and represent a clear concept from the theory. This is an art of understanding efficient coding. It also means that if you change a concept or augment your code, you might only have to make the change in one place even though that concept gets used in the code in multiple places.
      \item Avoid using global variables across functions.
      \item Use Python tuples to pass arguments between functions because the data types can vary across tuple elements (e.g., you can pack integer elements with float elements).
      \item Store sets of functions in intuitive groups in separate python script (\texttt{file.py}) files. Import these functions when needed using \texttt{import file as fl}. Then you can call those functions in your current script using \texttt{fl.func(...)}.
      \item Place comments and meta data extensively throughout your code. Every function should have explanations of what the function does, what are the inputs, what functions are called, what objects are created inside the function, and what is the output of the function. This will feel like overkill at the beginning, but it will save you and everyone else who every uses your code lots of time over the long run.
      \item Use the theory to map out what the optimal structure of your code should be. A universal principle in scientific computing is that insights, efficiency, and discovery can happen going both from theory to computation as well as from computation to theory. Use them both extensively. If you have a problem in the code, it might be highlighting an issue in the theory. If you have a problem in the theory, you might be able to discover the reason by computing different scenarios.
      \item Use parallelization where possible.
   \end{itemize}


\section{Simplest 3-period-lived Agent Problem}\label{Sec3perSimp}

   This is the same problem that you saw in Boot Camp. We have only changed the notation slightly.


   \subsection{Households}\label{Sec3perSimpHH}

      A unit measure of identical individuals are born each period and live for three periods. Let the age of an individual be indexed by $s = \{1,2,3\}$. In general, an age-$s$ individual faces a budget constraint each period that looks like the following:
      \begin{equation}\label{EqHHbc}
         c_{s,t} + b_{s+1,t+1} = w_t n_{s,t} + (1 + r_{t})b_{s,t} \quad\forall s,t
      \end{equation}
      We assume the individuals supply a unit of labor inelastically in the first two periods of life and are retired in the last period of life.
      \begin{equation}\label{EqHHlab}
         n_{s,t} = \begin{cases}
                      1\quad\text{if}\quad s = 1,2 \\
                      0\quad\text{if}\quad s = 3
                   \end{cases} \quad\forall s,t
      \end{equation}
      We also assume that households are born with no savings $b_{1,t} = 0$ and that individuals save no income in the last period of their lives $b_{4,t}=0$ for all periods $t$.

      These assumptions give rise to the three age-specific budget constraints that are a special case of \eqref{EqHHbc}.\footnote{Note that the 3-period-lived agent OLG model generalizes to the $S$-period-lived agent model. The more periods an agent lives, the more period budget constraints there are that look like \eqref{EqHHnolabBc2}.}
      \begin{align}
         c_{1,t} + b_{2,t+1} &= w_t \label{EqHHnolabBc1} \\
         c_{2,t+1} + b_{3,t+2} &= w_{t+1} + (1 + r_{t+1})b_{2,t+1} \label{EqHHnolabBc2} \\
         c_{3,t+2}\:\:\:\quad\quad\quad &= \quad\quad\quad\,(1 + r_{t+2})b_{3,t+2} \label{EqHHnolabBc3}
      \end{align}
      To simplify, we assume that $c_{s,t},b_{s,t}\geq 0$. However, the equilibrium is such that individuals will not want to borrow so we do not need to account for these non negativity constraints.\footnote{Note that middle-aged saving $b_{3,t}>0$ always in equilibrium. This is because if $b_{3,t}\leq 0$ in any period, $c_{3,t}\leq 0$. If $b_{3,t}>0$ always, then $b_{2,t}>0$ also because $c_{2,t}<$ when $b_{2,t}\leq 0$. This happens because the marginal utility of zero consumption is $-\infty$. This is called an Inada condition, which is a condition that moves optimal decisions away from the corners.}

      Let the utility of consumption in each period be defined by a function $u(c_{s,t})$, such that $u'>0$, $u''<0$, and $\lim_{c\rightarrow 0}u(c) = -\infty$. We will use the constant relative risk aversion (CRRA) utility function that takes the following form,
      \begin{equation}\label{EqHHutil}
         u(c_{s,t}) = \frac{(c_{s,t})^{1-\sigma}- 1}{1-\sigma}
      \end{equation}
      where the parameter $\sigma\geq 1$ represents the coefficient of relative risk aversion.

      Individuals choose lifetime consumption $\{c_{s,t+s-1}\}_{s=1}^3$, savings $\{b_{s+1,t+s}\}_{s=1}^2$ to maximize lifetime utility, subject to the budget constraints and non negativity constraints.
      \begin{equation}\label{EqHHmaxprob}
         \begin{split}
            &\max_{\{c_{s,t+s-1}\}_{s=1}^3,\{b_{s+1,t+s}\}_{s=1}^2}\:u(c_{1,t}) + \beta u(c_{2,t+1}) + \beta^2 u(c_{3,t+2}) \\
            &\quad\quad c_{1,t} = w_t - b_{2,t+1} \\
            &\quad\quad c_{2,t+1} = w_{t+1} + (1 + r_{t+1})b_{2,t+1} - b_{3,t+2} \\
            &\quad\quad c_{3,t+2} = (1 + r_{t+2})b_{3,t+2}
         \end{split}
      \end{equation}
      The number of variables to choose in the household's optimization problem can be reduced by substituting the budget constraints into the optimization problem \eqref{EqHHmaxprob} and assuming that the nonnegativity constraints on the two capital stocks do not bind.\footnote{Notice that the individual's problem can be reduced from 5 choice variables to 2 choice variables because the choice in the first two periods between consumption and savings is really just one choice. And the choice of how much to consume in the last period is trivial, because an individual just consumes all their income in the last period.}
      \begin{equation}\label{EqHHlagrang}
         \begin{split}
            \max_{b_{2,t+1},b_{3,t+2}}\:\mathcal{L} = &u\Bigl(w_t - b_{2,t+1}\Bigr) + \beta u\Bigl(w_{t+1} + [1 + r_{t+1}]b_{2,t+1} - b_{3,t+2}\Bigr) ... \\
            &\quad\quad + \beta^2 u\Bigl([1 + r_{t+2}]b_{3,t+2}\Bigr)
         \end{split}
      \end{equation}

      The optimal choice of how much to save in the second period of life $b_{3,t+2}$ is given by taking the derivative of the Lagrangian \eqref{EqHHlagrang} with respect to $b_{3,t+2}$ and setting it equal to zero.
      \begin{equation}\label{EqHHnolabfock3}
         \begin{split}
            \frac{\partial\mathcal{L}}{\partial b_{3,t+2}} = 0 \quad\Rightarrow\quad &u'\bigl(c_{2,t+1}\bigr) = \beta(1 + r_{t+2})u'\bigl(c_{3,t+2}\bigr) \\
            \Rightarrow\quad &u'\Bigl(w_{t+1} + [1 + r_{t+1}]b_{2,t+1} - b_{3,t+2}\Bigr) = ... \\
            &\quad\quad \beta(1 + r_{t+2})u'\Bigl([1 + r_{t+2}]b_{3,t+2}\Bigr)
         \end{split}
      \end{equation}
      Equation \eqref{EqHHnolabfock3} implies that the optimal savings for age-2 individuals is a function $\psi_{2,t+1}$ of the wage and interest rate in that period, the interest rate in the next period, and how much capital the individual saved in the previous period.
      \begin{equation}\label{EqHHk3funcpe}
         b_{3,t+2} = \psi_{2,t+1}\Bigl(w_{t+1},r_{t+1},r_{t+2},b_{2,t+1}\Bigr)
      \end{equation}

      The optimal choice of how much to save in the first period of life $b_{2,t+1}$ is a little more involved. The first order condition of the Lagrangian includes derivatives of $b_{3,t+2}$ with respect to $b_{2,t+1}$ because \eqref{EqHHnolabfock3} and \eqref{EqHHk3funcpe} show that optimal middle-aged savings $b_{3,t+2}$ is a function of savings when young $b_{2,t+1}$.
      \begin{equation}\label{EqHHfock2a}
         \begin{split}
            \frac{\partial\mathcal{L}}{\partial b_{2,t+1}} = 0 \quad\Rightarrow\quad &u'\bigl(c_{1,t}\bigr)  + \beta(1+r_{t+1})u'\bigl(c_{2,t+1}\bigr) ... \\
            &\quad - \beta u'\bigl(c_{2,t+1}\bigr)\frac{\partial\psi_{2,t+1}}{\partial b_{2,t+1}} + \beta^2(1+r_{t+2})u'\bigl(c_{3,t+2}\bigr)\frac{\partial\psi_{2,t+1}}{\partial b_{2,t+1}} = 0 \\
            \Rightarrow\quad &u'\Bigl(w_{t} - b_{2,t+1}\Bigr) = \\
            &\quad\beta(1 + r_{t+1})u'\Bigl([1 + r_{t+1}]b_{2,t+1} - b_{3,t+2}\Bigr) ... \\
            &\quad + \beta\frac{\partial \psi_{2,t+1}}{\partial b_{2,t+1}}\biggl[u'(c_{2,t+1}) - \beta(1+r_{t+2})u'(c_{3,t+2})\biggr]
         \end{split}
      \end{equation}

      Notice that the term in the brackets on the third line of \eqref{EqHHfock2a} equals zero because of the optimality condition \eqref{EqHHnolabfock3} for $b_{3,t+1}$. This is the envelope condition or the principle of optimality. The intuition is that I don't need to worry about the effect of my choice today on my choice tomorrow because I will optimize tomorrow given today. So the first order condition for optimal savings when young $b_{2,t+1}$ simplifies to the following expression.
      \begin{equation}\label{EqHHfock2b}
         \begin{split}
            \frac{\partial\mathcal{L}}{\partial b_{2,t+1}} = 0 \quad\Rightarrow\quad &u'\bigl(c_{1,t}\bigr) = \beta(1 + r_{t+1})u'\bigl(c_{2,t+1}\bigr) \\
            \Rightarrow\quad &u'\Bigl(w_{t} - b_{2,t+1}\Bigr) = ... \\
            &\quad \beta(1 + r_{t+1})u'\Bigl(w_{t+1} + [1 + r_{t+1}]b_{2,t+1} - \psi_{2,t+1}\Bigr)
         \end{split}
      \end{equation}
      Equation \eqref{EqHHfock2b} implies that the optimal savings for age-1 individuals is a function of the wages in that period and the next period and the interest rate in the next period and in the period after that.\footnote{The presence of $r_{t+2}$ in \eqref{EqHHk2funcpe} comes from the fact that optimal $b_{2,t+1}$ depends on the optimal $b_{3,t+2}$ from \eqref{EqHHk3funcpe}.}
      \begin{equation}\label{EqHHk2funcpe}
         b_{2,t+1} = \psi_{1,t}\Bigl(w_t,w_{t+1},r_{t+1},r_{t+2}\Bigr)
      \end{equation}

      Instead of looking at the age-1 and age-2 savings decisions of a particular individual, which happen in consecutive periods, we could look at the age-1 savings decisions of the young in period $t$ as characterized in \eqref{EqHHfock2b} and the age-2 savings decisions of the middle-aged in period $t$. This savings $b_{3,t+1}$ is characterized by the following first order condition, which is simply Equation \eqref{EqHHnolabfock3} iterated backward in time one period,
      \begin{equation}\label{EqHHnolabfock3b}
         \begin{split}
            u'\bigl(c_{2,t}\bigr) &= \beta(1+r_{t+1})u'\bigl(c_{3,t+1}\bigr) \\
            u'\Bigl(w_t + [1 + r_t]b_{2,t} - b_{3,t+1}\Bigr) &= \beta(1 + r_{t+1})u'\Bigl([1 + r_{t+1}]b_{3,t+1}\Bigr)
         \end{split}
      \end{equation}
      which implies that the period-$t$ savings decision of the middle aged is a function of the wage and interest rate in period-$t$, the interest rate in the period $t+1$, and how much capital the individual saved in the previous period.
      \begin{equation}\label{EqHHk3funcpeb}
         b_{3,t+1} = \psi_{2,t}\Bigl(w_{t},r_{t},r_{t+1},b_{2,t}\Bigr)
      \end{equation}

      Define $\bm{\Gamma}_t$ as the distribution of household savings across households at time $t$.
      \begin{equation}\label{EqSavDist}
         \bm{\Gamma}_t \equiv \bigl\{b_{2,t},b_{3,t}\bigr\} \quad\forall t
      \end{equation}
      As will be shown in Section \ref{Sec3perSimpEqlb}, the state as defined in Definition \ref{DefStateSpace} in every period $t$ for the entire equilibrium system described in the non-steady-state equilibrium characterized in Definition \ref{Def3perSimpNSSEql} is the current distribution of individual savings $\bm{\Gamma}_t$ from \eqref{EqSavDist}. Because individuals must forecast wages and interest rates in every period in order to solve their optimal lifetime decisions and because each of those future variables depends on the entire distribution of savings in the future, we must assume some individual beliefs about how the entire distribution will evolve over time. Let general beliefs about the future distribution of capital in period $t+u$ be characterized by the operator $\Omega(\cdot)$ such that:
      \begin{equation}\label{EqBeliefs}
         \bm{\Gamma}^e_{t+u} = \Omega^u\left(\bm{\Gamma}_t\right) \quad \forall t, \quad u\geq 1
      \end{equation}
      where the $e$ superscript signifies that $\bm{\Gamma}^e_{t+u}$ is the expected distribution of wealth at time $t+u$ based on general beliefs $\Omega(\cdot)$ that are not constrained to be correct.\footnote{In Section \ref{Sec3perSimpEqlb} we will assume that beliefs are correct (rational expectations) for the non-steady-state equilibrium in Definition \ref{Def3perSimpNSSEql}.}


   \subsection{Firms}\label{Sec3perSimpFirms}

      The economy also includes a unit measure of identical, perfectly competitive firms that rent investment capital from individuals for real return $r_t$ and hire labor for real wage $w_t$. Firms use their total capital $K_t$ and labor $L_t$ to produce output $Y_t$ every period according to a Cobb-Douglas production technology.
      \begin{equation}\label{EqFirmProdFunc}
         Y_t = F(K_t,L_t) \equiv AK_t^\alpha L_t^{1-\alpha}\quad\text{where}\quad \alpha\in(0,1) \quad\text{and}\quad A>0
      \end{equation}
      We assume that the price of the output in every period $P_t=1$.\footnote{This is just a cheap way to assume no monetary policy. Relaxing this assumption is important in many applications for which price fluctuation is important.} The representative firm chooses how much capital to rent and how much labor to hire to maximize profits,
      \begin{equation}\label{EqFirmProfMax}
         \max_{K_t,L_t}\: AK_t^\alpha L_t^{1-\alpha} - (r_t + \delta)K_t - w_t L_t
      \end{equation}
      where $\delta\in[0,1]$ is the rate of capital depreciation.\footnote{Note that it is equivalent whether we put depreciation on the firms' side as in equation \eqref{EqFirmProfMax} or on the household side making the return on capital savings $1+r_t-\delta$. Depreciation must be in one place or the other, not both. We choose to put depreciation on the firm's side here because the tax model we are building up to includes taxes and subsidies to firms for depreciation expenses.} The two first order conditions that characterize firm optimization are the following.
      \begin{align}
         r_t &= \alpha A\left(\frac{L_t}{K_t}\right)^{1-\alpha} - \delta \label{EqFirmFOCK} \\
         w_t &= (1-\alpha)A\left(\frac{K_t}{L_t}\right)^\alpha \label{EqFirmFOCL}
      \end{align}


   \subsection{Market clearing}\label{Sec3perSimpMC}

      Three markets must clear in this model: the labor market, the capital market, and the goods market. Each of these equations amounts to a statement of supply equals demand.
      \begin{align}
         L_t &= \sum_{s=1}^3 n_{s,t} = 2 \label{EqMCn} \\
         K_t &= \sum_{i=2}^3 b_{s,t} = b_{2,t} + b_{3,t} \label{EqMCk} \\
         Y_t &= C_t + K_{t+1} - (1-\delta)K_t \label{EqMCy}
      \end{align}
      The goods market clearing equation \eqref{EqMCy} is redundant by Walras' Law.


   \subsection{Equilibrium}\label{Sec3perSimpEqlb}

      Before providing exact definitions of the functional equilibrium concepts, I want to give a rough sketch of the equilibrium, so you can see what the functions look like and understand the exact equilibrium definition more clearly. A rough description of the equilibrium solution to the problem above is the following three points
      \begin{enumerate}
         \item Households optimize according to \eqref{EqHHfock2b} and \eqref{EqHHnolabfock3b}.
         \item Firms optimize according to \eqref{EqFirmFOCK} and \eqref{EqFirmFOCL}.
         \item Markets clear according to \eqref{EqMCn} and \eqref{EqMCk}.
      \end{enumerate}
      These equations characterize the equilibrium and constitute a system of nonlinear difference equations.

      The easiest way to understand the equilibrium solution is to substitute the  market clearing conditions \eqref{EqMCn} and \eqref{EqMCk} into the firm's optimal conditions \eqref{EqFirmFOCK} and \eqref{EqFirmFOCL} solve for the equilibrium wage and interest rate as functions of the distribution of capital.
      \begin{align}
         w_t\bigl(b_{2,t},b_{3,t}\bigr):\quad w_t &= (1-\alpha)A\left(\frac{b_{2,t}+b_{3,t}}{2}\right)^\alpha \label{EqEqlwt} \\
         r_t\bigl(b_{2,t},b_{3,t}\bigr):\:\quad r_t &= \alpha A\left(\frac{2}{b_{2,t}+b_{3,t}}\right)^{1-\alpha} - \delta \label{EqEqlrt}
      \end{align}
      Now \eqref{EqEqlwt} and \eqref{EqEqlrt} can be substituted into household Euler equations \eqref{EqHHfock2b} and \eqref{EqHHnolabfock3b} to get the following two-equation system that completely characterizes the equilibrium.
      \begin{equation}\label{EqEqlfock2}
         \begin{split}
            &u'\Bigl(w_t(b_{2,t},b_{3,t}) - b_{2,t+1}\Bigr) = \beta\Bigl(1 + r_{t+1}(b_{2,t+1},b_{3,t+1})\Bigr) \times... \\
            &\quad u'\Bigl(w_{t+1}(b_{2,t+1},b_{3,t+1}) + [1 + r_{t+1}(b_{2,t+1},b_{3,t+1})]b_{2,t+1} - b_{3,t+2}\Bigr)
         \end{split}
      \end{equation}
      \begin{equation}\label{EqEqlfock3}
         \begin{split}
            &u'\Bigl(w_t(b_{2,t},b_{3,t}) + [1 + r_t(b_{2,t},b_{3,t})]b_{2,t} - b_{3,t+1}\Bigr) = ... \\
            &\quad \beta\Bigl(1 + r_{t+1}(b_{2,t+1},b_{3,t+1})\Bigr)u'\Bigl([1 + r_{t+1}(b_{2,t+1},b_{3,t+1})]b_{3,t+1}\Bigr)
         \end{split}
      \end{equation}

      The system of two dynamic equations \eqref{EqEqlfock2} and \eqref{EqEqlfock3} characterizing the decisions for $b_{2,t+1}$ and $b_{3,t+1}$ is not identified. These households know the current distribution of capital $b_{2,t}$ and $b_{3,t}$. However, we need to solve for policy functions for $b_{2,t+1}$, $b_{3,t+1}$, and $b_{3,t+2}$ from these two equations. It looks like this system is unidentified. But the solution is a fixed point of stationary functions.

      We first define the steady-state equilibrium, which is exactly identified. Let the steady state of endogenous variable $x_t$ be characterized by $x_{t+1}=x_t=\bar{x}$ in which the endogenous variables are constant over time. Then we can define the steady-state equilibrium as follows.

      \end{spacing}
      \vspace{5mm}
      \hrule
      \vspace{-1mm}
      \begin{definition}[\textbf{Steady-state equilibrium}]\label{Def3perSimpSSEql}
         A non-autarkic steady-state equilibrium in the perfect foresight overlapping generations model with $3$-period lived agents is defined as constant allocations of consumption $\{\bar{c}_s\}_{s=1}^3$, capital $\{\bar{b}_s\}_{s=2}^3$, and prices $\bar{w}$ and $\bar{r}$ such that:
         \begin{enumerate}
            \item households optimize according to \eqref{EqHHfock2b} and \eqref{EqHHnolabfock3b},
            \item firms optimize according to \eqref{EqFirmFOCK} and \eqref{EqFirmFOCL},
            \item markets clear according to \eqref{EqMCn} and \eqref{EqMCk}.
         \end{enumerate}
      \end{definition}
      \vspace{-2mm}
      \hrule
      \vspace{5mm}
      \begin{spacing}{1.5}

      As we saw earlier in this section, the characterizing equations in Definition \ref{Def3perSimpSSEql} reduce to \eqref{EqEqlfock2} and \eqref{EqEqlfock3}. These two equations are exactly identified in the steady state. That is, they are two equations and two unknowns ($\bar{b}_2,\bar{b}_3$).
      \begin{equation}\label{EqEqlfock2SS}
         u'\Bigl(w(\bar{b}_2,\bar{b}_3) - \bar{b}_2\Bigr) = \beta\Bigl(1 + r(\bar{b}_2,\bar{b}_3)\Bigr)u'\Bigl(w(\bar{b}_2,\bar{b}_3) + [1 + r(\bar{b}_2,\bar{b}_3)]\bar{b}_2 - \bar{b}_3\Bigr)
      \end{equation}
      \begin{equation}\label{EqEqlfock3SS}
         \begin{split}
            &u'\Bigl(w(\bar{b}_2,\bar{b}_3) + [1 + r(\bar{b}_2,\bar{b}_3)]\bar{b}_2 - \bar{b}_3\Bigr) = ... \\
            &\quad\quad \beta\Bigl(1 + r(\bar{b}_2,\bar{b}_3)\Bigr)u'\Bigl([1 + r(\bar{b}_2,\bar{b}_3)]\bar{b}_3\Bigr)
         \end{split}
      \end{equation}
      We can solve for steady-state $\bar{b}_2$ and $\bar{b}_3$ by using a unconstrained optimization solver. Then we solve for $\bar{w}$, $\bar{r}$, $\bar{c}_1$, $\bar{c}_2$, and $\bar{c}_3$ by substituting $\bar{b}_2$ and $\bar{b}_3$ into the equilibrium firm first order conditions and into the household budget constraints.

      Now we can get ready to define the non-steady-state equilibrium. To do this, we need to define two other important concepts.

      \end{spacing}
      \vspace{5mm}
      \hrule
      \vspace{-1mm}
      \begin{definition}[\textbf{State of a dynamical system}]\label{DefStateSpace}
         The state of a dynamical system---sometimes called the state vector---is the smallest set of variables that completely summarizes all the information necessary for determining the future of the system at a given point in time.
      \end{definition}
      \vspace{-2mm}
      \hrule
      \vspace{5mm}
      \begin{spacing}{1.5}

      In the 3-period-lived agent, perfect foresight, OLG model described in this section, the state vector can be seen in equations \eqref{EqEqlfock2} and \eqref{EqEqlfock3}. What is the smallest set of variables that completely summarize all the information necessary for the three generations of all three generations living at time $t$ to make their consumption and saving decisions? What information do they have at time $t$ that will allow them to make their savings decisions? The state vector of this model in each period is the distribution of capital $(b_{2,t},b_{3,t})$.

      \end{spacing}
      \vspace{5mm}
      \hrule
      \vspace{-1mm}
      \begin{definition}[\textbf{Stationary function}]\label{DefStatnFunc}
         We define a stationary function to be a function that only depends upon its arguments and does not depend upon time.
      \end{definition}
      \vspace{-2mm}
      \hrule
      \vspace{5mm}
      \begin{spacing}{1.5}

      The relevant examples of stationary functions in this model are the policy functions for saving and investment. We defined the functions $\psi_{1,t}$ and $\psi_{2,t}$ generally in equations \eqref{EqHHk2funcpe} and \eqref{EqHHk3funcpeb}. But they were indexed by time as evidenced by the $t$ in $\psi_{1,t}$ and $\psi_{2,t}$. The stationary versions of those functions would be $\psi_{1}$ and $\psi_2$, which do not depend upon time. The arguments of the functions (the state) may change overtime causing the savings levels to change over time, but the function of the arguments is constant across time.

      With the concept of the state of a dynamical system and a stationary function, we are ready to define a functional non-steady-state equilibrium of the model.

      \end{spacing}
      \vspace{5mm}
      \hrule
      \vspace{-1mm}
      \begin{definition}[\textbf{Non-steady-state functional equilibrium}]\label{Def3perSimpNSSEql}
         A non-steady-state functional equilibrium in the perfect foresight overlapping generations model with $3$-period lived agents is defined as stationary allocation functions of the state $\psi_{1}\bigl(b_{2,t},b_{3,t}\bigr)$ and $\psi_{2}\bigl(b_{2,t},b_{3,t}\bigr)$ and stationary price functions $w(b_{2,t},b_{3,t})$ and $r(b_{2,t},b_{3,t})$ such that:
         \begin{enumerate}
            \item households have symmetric beliefs $\Omega(\cdot)$ about the evolution of the distribution of savings as characterized in \eqref{EqBeliefs}, and those beliefs about the future distribution of savings equal the realized outcome (rational expectations),
               \begin{equation*}
                  \bm{\Gamma}_{t+u} = \bm{\Gamma}^e_{t+u} = \Omega^u\left(\bm{\Gamma}_t\right) \quad\forall t,\quad u\geq 1
               \end{equation*}
            \item households optimize according to \eqref{EqHHfock2b} and \eqref{EqHHnolabfock3b},
            \item firms optimize according to \eqref{EqFirmFOCK} and \eqref{EqFirmFOCL},
            \item markets clear according to \eqref{EqMCn} and \eqref{EqMCk}.
         \end{enumerate}
      \end{definition}
      \vspace{-2mm}
      \hrule
      \vspace{5mm}
      \begin{spacing}{1.5}

      We have already shown how to boil down the characterizing equations in Definition \ref{Def3perSimpNSSEql} to two equations \eqref{EqEqlfock2} and \eqref{EqEqlfock3}. But we have also seen that those two equations are not identified. So how do we solve for these equilibrium functions? The solution to the non-steady-state equilibrium in Definition \ref{Def3perSimpNSSEql} is a fixed point in function space. Choose two functions $\psi_1$ and $\psi_2$ and verify that they satisfy the Euler equations for all points in the state space (all possible values of the state).


   \subsection{Solution method: time path iteration (TPI)}\label{Sec3perSimpTPI}

      The benchmark conventional solution method for the non-steady-state rational expectations equilibrium transition path in OLG models is outlined in \citet[ch. 4]{AuerbachKotlikoff:1987} for the perfect foresight case and in \citet[Appendix II]{NishiyamaSmetters:2007} and \citet[Sec. 3.1]{EvansPhillips:2014} for the stochastic case. We call this method time path iteration (TPI). The idea is that the economy is infinitely lived, even though the agents that make up the economy are not. Rather than recursively solving for equilibrium policy functions by iterating on individual value functions, one must recursively solve for the policy functions by iterating on the entire transition path of the endogenous objects in the economy (see \citet[ch. 17]{StokeyLucas1989}). \citet{EvansPhillips:2014} give a good description of how to implement this method.

      The key assumption is that the economy will reach the steady-state equilibrium $(\bar{b}_2,\bar{b}_3)$ described in Definition \ref{Def3perSimpSSEql} in a finite number of periods $T<\infty$ regardless of the initial state $(b_{2,1},b_{3,1})$. The first step is to assume a transition path for aggregate capital $\bm{K}^i = \left\{K_1^i,K_2^i,...K_T^i\right\}$ such that $T$ is sufficiently large to ensure that $(b_{2,T},b_{3,T}) = (\bar{b}_2,\bar{b}_3)$. The superscript $i$ is an index for the iteration number. The transition path for aggregate capital determines the transition path for both the real wage $\bm{w}^i = \left\{w_1^i,w_2^i,...w_T^i\right\}$ and the real return on investment $\bm{r}^i = \left\{r_1^i,r_2^i,...r_T^i\right\}$. The exact initial distribution of capital in the first period $(b_{2,1},b_{3,1})$ can be arbitrarily chosen as long as it satisfies $K_1^i = b_{2,1} + b_{3,1}$ according to market clearing condition \eqref{EqMCk}. One could also first choose the initial distribution of capital $(b_{2,1},b_{3,1})$ and then choose an initial aggregate capital stock $K_1^i$ that corresponds to that distribution. As mentioned earlier, the only other restriction on the initial transition path for aggregate capital is that it equal the steady-state level $K_T^i = \bar{K} = \bar{b}_2 + \bar{b}_3$ by period $T$. But the aggregate capital stocks $K_t^j$ for periods $1<t<T$ can be any level.

      Given the initial capital distribution $(b_{2,1},b_{3,1})$ and the transition paths of aggregate capital $\bm{K}^i = \left\{K_1^i,K_2^i,...K_T^i\right\}$, the real wage $\bm{w}^i = \left\{w_1^i,w_2^i,...w_T^i\right\}$, and the real return to investment $\bm{r}^i = \left\{r_1^i,r_2^i,...r_T^i\right\}$, one can solve for the optimal savings decision for the initial middle-aged $s=2$ individual for the last period of his life $b_{3,2}$ using his intertemporal Euler equation \eqref{EqEqlfock3}.
      \begin{equation}\label{EqEqlfock3tpi1}
         u'\Bigl(w_1^i + [1 + r_1^i]b_{2,1} - b_{3,2}\Bigr) = \beta\Bigl(1 + r_2^i\Bigr)u'\Bigl([1 + r_2^i]b_{3,2}\Bigr)
      \end{equation}
      Notice that everything in equation \eqref{EqEqlfock3tpi1} is known except for the savings decision $b_{3,2}$. This is one equation and one unknown.

      The next step is to solve for $b_{2,2}$ and $b_{3,3}$ for the initial young $s=1$ agent at period $1$ using the appropriately timed versions of \eqref{EqHHfock2b} and \eqref{EqHHnolabfock3} with the conjectured interest rates and real wages.
      \begin{equation}\label{EqHHnolabfock3tpi1}
         u'\Bigl(w_1^i - b_{2,2}\Bigr) = \beta(1 + r_2^i)u'\Bigl(w_2^i + [1 + r_2^i]b_{2,2} - b_{3,3}\Bigr)
      \end{equation}
      \begin{equation}\label{EqEqlfock3tpi2}
         u'\Bigl(w_2^i + [1 + r_2^i]b_{2,2} - b_{3,3}\Bigr) = \beta(1 + r_3^i)u'\Bigl([1 + r_3^i]b_{3,3}\Bigr)
      \end{equation}
      Everything is known in these two equations except for $b_{2,2}$ and $b_{3,3}$. So we can solve for those with a standard unconstrained solver. We next solve for $b_{2,t}$ and $b_{3,t+1}$ for the remaining $t\in\{3,4,...T+m\}$, where $T$ represents the period in the future at which the economy should have converged to the steady-state and $m$ represents some number of periods past that.\footnote{For models in which agents live for $S$ periods, $m\geq S$ so that the full distribution of capital at time $T$ can be solved for. In the 3-period-lived agent model described here, $m\geq 3$.}

      At this point, we have solved for the distribution of capital $(b_{2,t},b_{3,t})$ over the entire time period $t\in\{1,2,...T\}$. In each period $t$, the distribution of capital implies an aggregate capital stock $K_t^{i'} = b_{2,t} + b_{3,t}$. I put a ``$\, ' \,$'' on this aggregate capital stock because, in general, $K_t^{i'}\neq K_t^i$. That is, the conjectured path of the aggregate capital stock is not equal to the optimally chosen path of the aggregate capital stock given $\bm{K}^i$.\footnote{A check here for whether $T$ is large enough is if $K_T^{i'}=\bar{K}$ as well as $K_{T+1}^{i'}$ and $K_{T+2}^{i'}$. If not, then $T$ needs to be larger.}

      Let $\norm{\cdot}$ be a norm on the space of time paths for the aggregate capital stock. Common norms to use are the $L^2$ and the $L^\infty$ norms. Then the fixed point necessary for the equilibrium transition path from Definition \ref{Def3perSimpNSSEql} has been found when the distance between $\bm{K}^{i'}$ and $\bm{K}^{i}$ is arbitrarily close to zero.
      \begin{equation}\label{EqEqlTPIdist}
         \norm{\bm{K}^{i'} - \bm{K}^{i}} < \ve \quad\text{for}\quad \ve>0
      \end{equation}
      If the fixed point has not been found $\norm{\bm{K}^{i'} - \bm{K}^{i}} > \ve$, then a new transition path for the aggregate capital stock is generated as a convex combination of $\bm{K}^{i'}$ and $\bm{K}^{i}$.
      \begin{equation}\label{EqEqlTPInewpath}
         \bm{K}^{i+1} = \xi\bm{K}^{i'} + (1-\xi)\bm{K}^{i} \quad\text{for}\quad \xi\in(0,1)
      \end{equation}
      This process is repeated until the initial transition path for the aggregate capital stock is consistent with the transition path implied by those beliefs and household and firm optimization. TPI solves for the equilibrium transition path from Definition \ref{Def3perSimpNSSEql} by finding a fixed point in the time path of the economy.


   \subsection{Calibration}\label{Sec3perSimpCalibr}

      Use the following parameterization of the model for the problems below. Because agents live for only three periods, assume that each period of life is 20 years. If the annual discount factor is estimated to be 0.96, then the 20-year discount factor is $\beta = 0.96^{20} = 0.442$. Let the annual depreciation rate of capital be 0.05. Then the 20-year depreciation rate is $\delta = 1-(1-0.05)^{20} = 0.6415$. Let the coefficient of relative risk aversion be $\sigma = 3$, let the productivity scale parameter of firms be $A=1$, and let the capital share of income be $\alpha = 0.35$.


   \subsection{Exercises}\label{Sec3perSimpEx}

      \begin{exercise} \label{Ex3perSimp_SS}
         Using the calibration from Section \ref{Sec3perSimpCalibr} and the steady-state equilibrium Definition \ref{Def3perSimpSSEql}, solve for the steady-state equilibrium values of $\{\bar{c}_s\}_{s=1}^3$, $\{\bar{b}_s\}_{s=2}^3$, $\bar{w}$, and $\bar{r}$ numerically.
      \end{exercise}

      \begin{exercise} \label{Ex3perSimp_rho}
         What happens to each of these steady-state values if all households become more patient $\beta\uparrow$ (an example would be $\beta = 0.55$)? That is, in what direction does $\beta\uparrow$ move each steady-state value $\{\bar{c}_s\}_{s=1}^3$, $\{\bar{b}_s\}_{s=2}^3$, $\bar{w}$, and $\bar{r}$? What is the intuition?
      \end{exercise}

      \begin{exercise} \label{Ex3perSimp_TPI}
         Use time path iteration (TPI) to solve for the non-steady state equilibrium transition path of the economy from $(b_{2,1},b_{3,1})=(0.8\bar{b}_2,1.1\bar{b}_3)$ to the steady-state $(\bar{b}_2,\bar{b}_3)$. You'll have to choose a guess for $T$ and a time path updating parameter $\xi\in(0,1)$, but I can assure you that $T<50$. Use an $L^2$ norm for your distance measure (sum of squared percent deviations), and use a convergence parameter of $\ve = 10^{-9}$. Use a linear initial guess for the time path of the aggregate capital stock from the initial state $K_1^1$ to the steady state $K_T^1$ at time $T$.
      \end{exercise}

      \begin{exercise} \label{Ex3perSimp_TPIplot}
         Plot the equilibrium time path of the aggregate capital stock $\{K_t\}_{t=1}^{T+5}$. How many periods did it take for the economy to get within 0.0001 of the steady-state aggregate capital stock $\bar{K}$? That is, what is $T$?
      \end{exercise}


\newpage
\section{Simplest \textit{S}-period-lived Agent Problem}\label{SecSperSimp}

   Now we take the 3-period-lived agent problem from Section \ref{Sec3perSimp} and generalize it to an $S\in[3,80]$ period lived agent problem.


   \subsection{Households}\label{SecSperSimpHH}

      A unit measure of identical individuals are born each period and live for three periods. Let the age of an individual be indexed by $s = \{1,2,...S\}$. In general, an age-$s$ individual faces the same per-period budget constraint \eqref{EqHHbc} as in the previous section.
      \begin{equation}\tag{\ref{EqHHbc}}
         c_{s,t} + b_{s+1,t+1} = w_t n_{s,t} + (1 + r_{t})b_{s,t} \quad\forall s,t
      \end{equation}
      We assume the individuals supply a unit of labor inelastically in the first two thirds of life ($s\leq \text{round}(2S/3)$) and are retired during the last third of life ($s>\text{round}(S/3)$).
      \begin{equation}\label{EqSHHlab}
         n_{s,t} = \begin{cases}
                      1\quad\text{if}\quad s\leq \text{round}\left(\frac{2S}{3}\right) \\
                      0\quad\text{if}\quad s> \text{round}\left(\frac{S}{3}\right)
                   \end{cases} \quad\forall s,t
      \end{equation}
      Because exogenous labor in \eqref{EqSHHlab} is not dependent on the time period, we drop the $t$ subscript from labor $n_s$ for the rest of this section. We also assume that households are born with no savings $b_{1,t} = 0$ and that individuals save no income in the last period of their lives $b_{S+1,t}=0$ for all periods $t$. Assume that $c_{s,t}\geq 0$ because negative consumption neither has an intuitive interpretation nor is it household utility defined for it. It is the latter condition that will make $c_{s,t}>0$ in equilibrium.

      Let the utility of consumption in each period be defined by the constant relative risk aversion function \eqref{EqHHutil} $u(c_{s,t})$ from the previous section, such that $u'>0$, $u''<0$, and $\lim_{c\rightarrow 0}u(c) = -\infty$. Individuals choose lifetime consumption $\{c_{s,t+s-1}\}_{s=1}^S$, savings $\{b_{s+1,t+s}\}_{s=1}^{S-1}$ to maximize lifetime utility, subject to the budget constraints and non negativity constraints.
      \begin{equation}\label{EqSHHmaxprob}
         \begin{split}
            &\max_{\{c_{s,t+s-1}\}_{s=1}^S,\{b_{s+1,t+s}\}_{s=1}^{S-1}}\:\sum_{u=0}^{S-s}\beta^u u(c_{s+u,t+u}) \quad\forall s,t \\
            &\quad\text{s.t.}\quad c_{s,t} = (1 + r_t)b_{s,t} + w_{t}n_s - b_{s+1,t+1} \quad\forall s,t \\
            &\quad\text{and}\quad b_{1,t},b_{S+1,t}=0 \quad\forall t \quad\text{and}\quad c_{s,t}\geq 0 \quad\forall s,t
         \end{split}
      \end{equation}

      The number of variables to choose in the household's optimization problem can be reduced by substituting the budget constraints into the optimization problem \eqref{EqSHHmaxprob}. The optimal choice of how much to save in the each of the first $S-1$ periods of life $b_{s+1,t+1}$ is found by taking the derivative of the lifetime utility function with respect to each of the lifetime savings amounts $\{b_{s+1,t+s+1}\}_{s=1}^{S-1}$ and setting the derivatives equal to zero.

      In the last period of life, the household optimally chooses no savings $b_{S+1,t+1}=0$ for all $t$ because any positive savings only imposes a cost of reduced consumption, and negative savings (borrowing) would impose an automatic default on anyone lending to him. The final period $S$ decision is simple. The individual enters the period with wealth $b_{S,t}$, he knows the interest rate $r_t$ and the wage $w_t$, and inelatically supplies zero labor $n_{S,t}=0$. Everything in the budget constraint \eqref{EqHHbc} is determined except for $c_{S,t}$. In the final period, the individual simply consumes all his resources.
      \begin{equation}\label{EqScSt}
         c_{S,t} = (1 + r_{t})b_{S,t} \quad\forall t
      \end{equation}

      In the second-to-last period of life $s=S-1$, the household has a savings decision to make. He enters the period with wealth $b_{S-1,t}$, he knows the current interest rate $r_t$ and the current wage $w_t$, and he must know or be able to forecast next period's interest rate $r_{t+1}$ and wage $w_{t+1}$. In this case, the household's lifetime utility function is one equation and one unknown.
      \begin{equation}\label{EqSlifutSm1}
         \max_{b_{S,t+1}} u\Bigl(w_t n_{S-1} + (1 + r_{t})b_{S-1,t} - b_{S,t+1}\Bigr) + \beta u\Bigl((1 + r_{t+1})b_{S,t+1}\Bigr)
      \end{equation}
      The first order condition, or dynamic Euler equation, for this second-to-last period of life savings decision is the following.
      \begin{equation}\label{EqSsaveulSm1}
         \Bigl(w_t n_{S-1} + (1 + r_{t})b_{S-1,t} - b_{S,t+1}\Bigr)^{-\sigma} = \beta(1+r_{t+1})\Bigl((1 + r_{t+1})b_{S,t+1}\Bigr)^{-\sigma}
      \end{equation}
      The solution for savings $b_{S,t+1}$ in the second-to-last period of life to be returned with interest in the last period of life is characterized by the nonlinear dynamic Euler equation \eqref{EqSsaveulSm1} and is a function of individual wealth $b_{S-1,t}$, the interest rate $r_t$, and the wage $w_t$ at the beginning of the second-to-last period of life, as well as the interest rate $r_{t+1}$ in the last period of life.
      \begin{equation}\label{EqSpsiSm1}
         b_{S,t+1} = \psi_{S-1}\left(b_{S-1,t}, r_t, w_t, r_{t+1}\right) \quad\forall t
      \end{equation}
      Call $\psi_{S-1}(\cdot)$ the policy function for savings $b_{S,t+1}$ in the second-to-last period of life.

      In the third-to-last period of life $s=S-2$, the individual has two remaining lifetime decisions to make. He must choose how much to save in the third-to-last period of life $b_{S-1,t}$ and how much to save in the second-to-last period of life $b_{S,t+1}$. The latter of these two decisions will be characterized by the same function \eqref{EqSpsiSm1} that equates \eqref{EqSsaveulSm1}. However, the maximization problem is trickier for the third-to-last period savings $b_{S-1,t}$ because the individual must maximize utility over three periods.
      \begin{equation}\label{EqSlifutSm2}
         \begin{split}
            &\max_{b_{S-1,t}} u\Bigl(w_{t-1} n_{S-2} + (1 + r_{t-1})b_{S-2,t-1} - b_{S-1,t}\Bigr) + ... \\
            &\quad \beta u\Bigl(w_t n_{S-1} + (1 + r_{t})b_{S-1,t} - b_{S,t+1}\Bigr) + \beta^2 u\Bigl((1 + r_{t+1})b_{S,t+1}\Bigr)
         \end{split}
      \end{equation}
      It initially looks like the savings $b_{S-1,t}$ only shows up in two places, which should make this derivative very easy. However, we must remember that it is also in the optimal function for the second to last period savings $b_{S,t+1}$ from \eqref{EqSpsiSm1}. The derivative of \eqref{EqSlifutSm2} with respect to $b_{S-1,t}$ and set equal to zero is, therefore,
      \begin{equation}\label{EqSsaveulSm2a}
         -u'(c_{S-2,t-1}) + \beta\left(1 + r_t - \frac{\partial\psi_{S-1}}{\partial b_{S-1,t}}\right)u'(c_{S-1,t}) + \beta^2(1+r_{t+1})\frac{\partial\psi_{S-1}}{\partial b_{S-1,t}}u'(c_{S,t+1}) = 0
      \end{equation}

      This looks very different from the equation characterizing optimal savings in the second-to-last period \eqref{EqSlifutSm1}. However, factoring out the partial derivative terms gives the following version of the equation.
      \begin{equation}\label{EqSsaveulSm2b}
         -u'(c_{S-2,t-1}) + \beta(1+r_t)u'(c_{S-1,t}) = \beta\frac{\partial\psi_{S-1}}{\partial b_{S-1,t}}\Bigl[u'(c_{S-1,t}) - \beta(1+r_{t+1})u'(c_{S,t+1})\Bigr]
      \end{equation}
      Notice that the term on the right in brackets is zero from \eqref{EqSlifutSm1}. This is the envelope theorem or the principle of optimality. It means that the savings decisions in all future periods will be made optimally, so the derivative of that function will be zero with respect to today's savings. The third-to-last period Euler equation in \eqref{EqSsaveulSm2b} reduces to the following due to the envelope theorem.
      \begin{equation}\label{EqSsaveulSm2c}
         u'(c_{S-2,t-1}) = \beta(1+r_t)u'(c_{S-1,t})
      \end{equation}
      Using the expressions for $c_{S-2,t-1}$ and $c_{S-1,t}$ from the budget constraint \eqref{EqHHbc} and the function for second-to-last period savings $b_{S,t+1}$ from \eqref{EqSpsiSm1}, it is simple to show that the policy function for third-to-last period savings $b_{S-1,t}$ characterized by nonlinear dynamic Euler equation \eqref{EqSsaveulSm2c} is the following.
      \begin{equation}\label{EqSpsiSm2}
         b_{S-1,t} = \psi_{S-2}\left(b_{S-2,t-1}, r_{t-1}, w_{t-1}, r_{t}, w_{t}, r_{t+1}\right) \quad\forall t
      \end{equation}

      By backward induction, it is straightforward to show that the $S-1$ savings decisions over an individual's lifetime are characterized by $S-1$ nonlinear dynamic Euler equations of the form,
      \begin{equation}\label{EqSeulGen}
         \begin{split}
            &u'(c_{s,t}) = \beta(1+r_{t+1})u'(c_{s+1,t+1}) \quad\forall t,\quad\text{and}\quad 1\leq s\leq S-1 \\
            &\qquad\text{and}\quad c_{s,t} = w_t n_s + (1 + r_{t})b_{s,t} - b_{s+1,t+1} \quad\forall s,t \\
            &\qquad\text{and}\quad b_{1,t},b_{S-1,t} = 0 \quad\forall t
         \end{split}
      \end{equation}
      Following the pattern of \eqref{EqSpsiSm1} and \eqref{EqSpsiSm2}, the policy functions for each of the savings decisions is a function of the individual's wealth at the beginning of the period $b_{s,t}$ and the time path of wages and interest rates over the remaining periods of the individual's life.
      \begin{equation}\label{EqSpsiGen}
         b_{s+1,t+1} = \psi_{s}\Bigl(b_{s,t}, \{r_v\}_{u=t}^{t+S-s}, \{w_u\}_{u=t}^{t+S-s-1}\Bigr) \quad\forall t \quad\text{and}\quad 1\leq s\leq S-1
      \end{equation}
      To summarize the individual's problem, if one knows his initial savings or wealth $b_{s,t}$ and the time path of factor prices over his remaining lifetime, he can solve for all of his optimal savings levels $\{b_{s+1,t+s}\}_{s=1}^{S-1}$.

      To conclude the household's problem, we must make an assumption about how the age-$s$ household can forecast the time path of interest rates and wages $\{r_u, w_u\}_{u=t}^{t+S-s}$ over his remaining lifetime. As we will show in Section \ref{SecSperSimpEqlb}, the equilibrium interest rate $r_t$ and wage $w_t$ will be functions of the state vector $\bm{\Gamma}_t$, which turns out to be the entire distribution of savings at in period $t$.

      Define $\bm{\Gamma}_t$ as the distribution of household savings across households at time $t$.
      \begin{equation}\label{EqSsavDist}
         \bm{\Gamma}_t \equiv \bigl\{b_{s,t}\bigr\}_{s=2}^S \quad\forall t
      \end{equation}
      Let general beliefs about the future distribution of capital in period $t+u$ be characterized by the operator $\Omega(\cdot)$ such that:
      \begin{equation}\tag{\ref{EqBeliefs}}
         \bm{\Gamma}^e_{t+u} = \Omega^u\left(\bm{\Gamma}_t\right) \quad \forall t, \quad u\geq 1
      \end{equation}
      where the $e$ superscript signifies that $\bm{\Gamma}^e_{t+u}$ is the expected distribution of wealth at time $t+u$ based on general beliefs $\Omega(\cdot)$ that are not constrained to be correct.\footnote{In Section \ref{SecSperSimpEqlb} we will assume that beliefs are correct (rational expectations) for the non-steady-state equilibrium in Definition \ref{DefSperSimpNSSEql}.}


   \subsection{Firms}\label{SecSperSimpFirms}

      The production side of this economy is identical to the one in Section \ref{Sec3perSimpFirms} with a unit measure of identical, perfectly competitive firms that rent investment capital from individuals for real return $r_t$ and hire labor for real wage $w_t$. Firms use their total capital $K_t$ and labor $L_t$ to produce output $Y_t$ every period according to a Cobb-Douglas production technology,
      \begin{equation}\tag{\ref{EqFirmProdFunc}}
         Y_t = F(K_t,L_t) \equiv AK_t^\alpha L_t^{1-\alpha}\quad\text{where}\quad \alpha\in(0,1) \quad\text{and}\quad A>0.
      \end{equation}
      The representative firm chooses how much capital to rent and how much labor to hire to maximize profits,
      \begin{equation}\tag{\ref{EqFirmProfMax}}
         \max_{K_t,L_t}\: AK_t^\alpha L_t^{1-\alpha} - (r_t + \delta)K_t - w_t L_t
      \end{equation}
      where $\delta\in[0,1]$ is the rate of capital depreciation, and the two first order conditions that characterize firm optimization are the following.
      \begin{align}
         r_t &= \alpha A\left(\frac{L_t}{K_t}\right)^{1-\alpha} - \delta \tag{\ref{EqFirmFOCK}} \\
         w_t &= (1-\alpha)A\left(\frac{K_t}{L_t}\right)^\alpha \tag{\ref{EqFirmFOCL}}
      \end{align}


   \subsection{Market clearing}\label{SecSperSimpMC}

      Three markets must clear in this model: the labor market, the capital market, and the goods market. Each of these equations amounts to a statement of supply equals demand.
      \begin{align}
         L_t &= \sum_{s=1}^S n_s \label{EqSMCn} \\
         K_t &= \sum_{i=2}^S b_{s,t} \label{EqSMCk} \\
         Y_t &= C_t + K_{t+1} - (1-\delta)K_t \label{EqSMCy}
      \end{align}
      The goods market clearing equation \eqref{EqSMCy} is redundant by Walras' Law.


   \subsection{Equilibrium}\label{SecSperSimpEqlb}

      Before providing exact definitions of the functional equilibrium concepts, we give a rough sketch of the equilibrium, so you can see what the functions look like and understand the exact equilibrium definition more clearly. A rough description of the equilibrium solution to the problem above is the following three points
      \begin{enumerate}
         \item Households optimize according to equations \eqref{EqSeulGen}.
         \item Firms optimize according to \eqref{EqFirmFOCK} and \eqref{EqFirmFOCL}.
         \item Markets clear according to \eqref{EqSMCn} and \eqref{EqSMCk}.
      \end{enumerate}
      These equations characterize the equilibrium and constitute a system of nonlinear difference equations.

      The easiest way to understand the equilibrium solution is to substitute the  market clearing conditions \eqref{EqSMCn} and \eqref{EqSMCk} into the firm's optimal conditions \eqref{EqFirmFOCK} and \eqref{EqFirmFOCL} solve for the equilibrium wage and interest rate as functions of the distribution of capital.
      \begin{align}
         w_t\bigl(\bm{\Gamma}_t\bigr):\quad w_t &= (1-\alpha)A\left(\frac{\sum_{s=2}^S b_{s,t}}{\sum_{s=1}^S n_s}\right)^\alpha \label{EqSEqlwt} \\
         r_t\bigl(\bm{\Gamma}_t\bigr):\:\quad r_t &= \alpha A\left(\frac{\sum_{s=1}^S n_s}{\sum_{s=2}^S b_{s,t}}\right)^{1-\alpha} - \delta \label{EqSEqlrt}
      \end{align}
      Now \eqref{EqSEqlwt} and \eqref{EqSEqlrt} can be substituted into household Euler equations \eqref{EqSeulGen} to get the following $S-1$-equation system that completely characterizes the equilibrium.
      \begin{equation}\label{EqSEqlEulGen}
         \begin{split}
            &u'\biggl(w_t\bigl(\bm{\Gamma}_t\bigr)n_s + \Bigl[1 + r_{t}\bigl(\bm{\Gamma}_t\bigr)\Bigr]b_{s,t} - b_{s+1,t+1}\biggr) =  \\
            &\qquad \beta\Bigl[1+r_{t+1}\bigl(\bm{\Gamma}_{t+1}\bigr)\Bigr]u'\biggl(w_{t+1}\bigl(\bm{\Gamma}_{t+1}\bigr)n_{s+1} + \Bigl[1 + r_{t+1}\bigl(\bm{\Gamma}_{t+1}\bigr)\Bigr]b_{s+1,t+1} - b_{s+2,t+2}\biggr) \\
            &\qquad\qquad\forall t,\quad\text{and}\quad 1\leq s\leq S-1
         \end{split}
      \end{equation}

      The system of $S-1$ nonlinear dynamic equations \eqref{EqSEqlEulGen} characterizing the the lifetime savings decisions for each household $\{b_{s+1,t+s}\}_{s=1}^{S-1}$ is not identified. Each individual knows the current distribution of capital $\bm{\Gamma}_t$. However, we need to solve for policy functions for the entire distribution of capital in the next period $\bm{\Gamma}_{t+1}=\{\{b_{s+1,t+1}\}_{s=1}^{S-1}\}$ for all agents alive next period, and for a policy function for the individual $b_{s+2,t+2}$ from these $S-1$ equations. Even if we pile together all the sets of individual lifetime Euler equations, it looks like this system is unidentified. This is because it is a series of second order difference equations. But the solution is a fixed point of stationary functions.

      We first define the steady-state equilibrium, which is exactly identified. Let the steady state of endogenous variable $x_t$ be characterized by $x_{t+1}=x_t=\bar{x}$ in which the endogenous variables are constant over time. Then we can define the steady-state equilibrium as follows.

      \end{spacing}
      \vspace{5mm}
      \hrule
      \vspace{-1mm}
      \begin{definition}[\textbf{Steady-state equilibrium}]\label{DefSperSimpSSEql}
         A non-autarkic steady-state equilibrium in the perfect foresight overlapping generations model with $S$-period lived agents is defined as constant allocations of consumption $\{\bar{c}_s\}_{s=1}^S$, capital $\{\bar{b}_s\}_{s=2}^S$, and prices $\bar{w}$ and $\bar{r}$ such that:
         \begin{enumerate}
            \item households optimize according to \eqref{EqSeulGen},
            \item firms optimize according to \eqref{EqFirmFOCK} and \eqref{EqFirmFOCL},
            \item markets clear according to \eqref{EqSMCn} and \eqref{EqSMCk}.
         \end{enumerate}
      \end{definition}
      \vspace{-2mm}
      \hrule
      \vspace{5mm}
      \begin{spacing}{1.5}

      As we saw earlier in this section, the characterizing equations in Definition \ref{DefSperSimpSSEql} reduce to \eqref{EqSEqlEulGen}. These $S-1$ equations are exactly identified in the steady state. That is, they are $S-1$ equations and $S-1$ unknowns $\{\bar{b}_s\}_{s=2}^S$.
      \begin{equation}\label{EqSEqlEulSS}
         \begin{split}
            &u'\biggl(\bar{w}\bigl(\bm{\bar{\Gamma}}\bigr)n_s + \Bigl[1 + \bar{r}\bigl(\bm{\bar{\Gamma}}\bigr)\Bigr]\bar{b}_s - \bar{b}_{s+1}\biggr) =  \\
            &\qquad \beta\Bigl[1+\bar{r}\bigl(\bm{\bar{\Gamma}}\bigr)\Bigr]u'\biggl(\bar{w}\bigl(\bm{\bar{\Gamma}}\bigr)n_{s+1} + \Bigl[1 + \bar{r}\bigl(\bm{\bar{\Gamma}}\bigr)\Bigr]\bar{b}_{s+1} - \bar{b}_{s+2}\biggr) \\
            &\qquad\qquad\text{for}\quad 1\leq s\leq S-1
         \end{split}
      \end{equation}
      We can solve for steady-state $\{\bar{b}_s\}_{s=2}^S$ by using an unconstrained optimization solver. Then we solve for $\bar{w}$, $\bar{r}$, and $\{\bar{c}_s\}_{s=1}^S$ by substituting $\{\bar{b}_s\}_{s=2}^S$ into the equilibrium firm first order conditions and into the household budget constraints.

      In the $S$-period-lived agent, perfect foresight, OG model described in this section, the state vector can be seen in the system of Euler equations \eqref{EqSEqlEulGen}. What is the smallest set of variables that completely summarize all the information necessary for the three generations of all three generations living at time $t$ to make their consumption and saving decisions? What information do they have at time $t$ that will allow them to make their savings decisions? The state vector of this model in each period is the distribution of capital $\bm{\Gamma_t}$.

      \end{spacing}
      \vspace{5mm}
      \hrule
      \vspace{-1mm}
      \begin{definition}[\textbf{Non-steady-state functional equilibrium}]\label{DefSperSimpNSSEql}
         A non-steady-state functional equilibrium in the perfect foresight overlapping generations model with $S$-period lived agents is defined as stationary allocation functions of the state $\bigl\{b_{s+1,t+1}=\psi_{s}\bigl(\bm{\Gamma}_t\bigr)\bigr\}_{s=1}^{S-1}$ and stationary price functions $w(\bm{\Gamma}_t)$ and $r(\bm{\Gamma}_t)$ such that:
         \begin{enumerate}
            \item households have symmetric beliefs $\Omega(\cdot)$ about the evolution of the distribution of savings as characterized in \eqref{EqBeliefs}, and those beliefs about the future distribution of savings equal the realized outcome (rational expectations),
               \begin{equation*}
                  \bm{\Gamma}_{t+u} = \bm{\Gamma}^e_{t+u} = \Omega^u\left(\bm{\Gamma}_t\right) \quad\forall t,\quad u\geq 1
               \end{equation*}
            \item households optimize according to \eqref{EqSEqlEulGen},
            \item firms optimize according to \eqref{EqFirmFOCK} and \eqref{EqFirmFOCL},
            \item markets clear according to \eqref{EqSMCn} and \eqref{EqSMCk}.
         \end{enumerate}
      \end{definition}
      \vspace{-2mm}
      \hrule
      \vspace{5mm}
      \begin{spacing}{1.5}

      We have already shown how to boil down the characterizing equations in Definition \ref{DefSperSimpNSSEql} to $S-1$ equations \eqref{EqSEqlEulGen} and $S-1$ unknowns. But we have also seen that those $S-1$ equations are not identified. So how do we solve for these equilibrium functions? The solution to the non-steady-state equilibrium in Definition \ref{DefSperSimpNSSEql} is a fixed point in function space. Choose $S-1$ functions $\{\psi_s\}_{s=1}^{S-1}$ and verify that they satisfy the Euler equations for all points in the state space (all possible values of the state).


   \subsection{Solution method: time path iteration (TPI)}\label{SecSperSimpTPI}

      The solution method is time path iteration (TPI) as described in Section \ref{Sec3perSimpTPI}. The key assumption is that the economy will reach the steady-state equilibrium $\bm{\bar{\Gamma}}$ described in Definition \ref{DefSperSimpSSEql} in a finite number of periods $T<\infty$ regardless of the initial state $\bm{\Gamma}_1$.

      The first step is to assume a transition path for aggregate capital $\bm{K}^i = \left\{K_1^i,K_2^i,...K_T^i\right\}$ such that $T$ is sufficiently large to ensure that $\bm{\Gamma}_T = \bm{\bar{\Gamma}}$. The superscript $i$ is an index for the iteration number. The transition path for aggregate capital determines the transition path for both the real wage $\bm{w}^i = \left\{w_1^i,w_2^i,...w_T^i\right\}$ and the real return on investment $\bm{r}^i = \left\{r_1^i,r_2^i,...r_T^i\right\}$. The exact initial distribution of capital in the first period $\bm{\Gamma}_1$ can be arbitrarily chosen as long as it satisfies $K_1^i = \sum_{s=2}^S b_{s,1}$ according to market clearing condition \eqref{EqSMCk}. One could also first choose the initial distribution of capital $\bm{\Gamma}_1$ and then choose an initial aggregate capital stock $K_1^i$ that corresponds to that distribution. As mentioned earlier, the only other restriction on the initial transition path for aggregate capital is that it equal the steady-state level $K_T^i = \bar{K} = \sum_{s=2}^S\bar{b}_s$ by period $T$. But the initial guess for the aggregate capital stocks $K_t^j$ for periods $1<t<T$ can be any level.

      Given the initial capital distribution $\bm{\Gamma}_1$ and the transition paths of aggregate capital $\bm{K}^i = \left\{K_1^i,K_2^i,...K_T^i\right\}$, the real wage $\bm{w}^i = \left\{w_1^i,w_2^i,...w_T^i\right\}$, and the real return to investment $\bm{r}^i = \left\{r_1^i,r_2^i,...r_T^i\right\}$, one can solve for the optimal savings decision for the initial age $s=S-1$ individual for the last period of his life $b_{S,2}$ using his last intertemporal Euler equation similar to \eqref{EqSsaveulSm1}.
      \begin{equation}\label{EqSsaveulSm1t1}
         u'\Bigl(w_1^i n_{S-1} + [1 + r_1^i]b_{S-1,1} - b_{S,2}\Bigr) = \beta\Bigl(1 + r_2^i\Bigr)u'\Bigl([1 + r_2^i]b_{S,2}\Bigr)
      \end{equation}
      Notice that everything in equation \eqref{EqSsaveulSm1t1} is known except for the savings decision $b_{S,2}$. This is one equation and one unknown.

      The next step is to solve for the remaining lifetime savings decisions for the next oldest individual alive in period $t=1$. This individual is age $s=S-2$ and has two remaining savings decisions $b_{S-1,2}$ and $b_{S,3}$. From \eqref{EqSeulGen}, we know that the two equations that characterize these two decisions are the following.
      \begin{equation}\label{EqSsaveulSm2t1}
         u'\Bigl(w_1^i n_{S-2} + [1 + r_1^i]b_{S-2,1} - b_{S-1,2}\Bigr) = \beta(1 + r_2^i)u'\Bigl(w_2^i n_{S-1} + [1 + r_2^i]b_{S-1,2} - b_{S,3}\Bigr)
      \end{equation}
      \begin{equation}\label{SsaveulSm1t2}
         u'\Bigl(w_2^i n_{S-1} + [1 + r_2^i]b_{S-1,2} - b_{S,3}\Bigr) = \beta(1 + r_3^i)u'\Bigl([1 + r_3^i]b_{S,3}\Bigr)
      \end{equation}
      Euler equations \eqref{EqSsaveulSm2t1} and \eqref{SsaveulSm1t2} represent two equations and two unknowns $b_{S-1,2}$ and $b_{S,3}$. Everything else is known.

      We continue solving the remaining lifetime decisions of each individual alive between periods 1 and $T$. This includes all the individuals who were already alive in period 1 and therefore have fewer than $S-1$ savings decisions to solve for. It also includes all the individuals born between periods 1 and $T$ for whom we have the full set of $S-1$ lifetime decisions. Once we have solved for all the individual savings decisions for individuals alive between periods 1 and $T$, then we have the complete distribution of savings $\{\bm{\Gamma}_t\}_{t=1}^T$ for each period between 1 and $T$. We can use this to compute a new time path of the aggregate capital stock consistent with the individual savings decisions $K_t^{i'} = \sum_{s=2}^S b_{s,t}$ for all $1\leq t\leq T$. I put a ``$\, ' \,$'' on this aggregate capital stock because, in general, $K_t^{i'}\neq K_t^i$. That is, the initial conjectured path of the aggregate capital stock from which the savings decisions were made is not necessarily equal to the path of the aggregate capital stock consistent with those savings decisions.\footnote{A check here for whether $T$ is large enough is if $K_T^{i'}=\bar{K}$ as well as $K_{T+1}^{i'}$ and $K_{T+2}^{i'}$. If not, then $T$ needs to be larger.}

      Let $\norm{\cdot}$ be a norm on the space of time paths for the aggregate capital stock. Common norms to use are the $L^2$ and the $L^\infty$ norms. Then the fixed point necessary for the equilibrium transition path from Definition \ref{DefSperSimpNSSEql} has been found when the distance between $\bm{K}^{i'}$ and $\bm{K}^{i}$ is arbitrarily close to zero.
      \begin{equation}\tag{\ref{EqEqlTPIdist}}
         \norm{\bm{K}^{i'} - \bm{K}^{i}} < \ve \quad\text{for}\quad \ve>0
      \end{equation}
      If the fixed point has not been found $\norm{\bm{K}^{i'} - \bm{K}^{i}} > \ve$, then a new transition path for the aggregate capital stock is generated as a convex combination of $\bm{K}^{i'}$ and $\bm{K}^{i}$.
      \begin{equation}\tag{\ref{EqEqlTPInewpath}}
         \bm{K}^{i+1} = \xi\bm{K}^{i'} + (1-\xi)\bm{K}^{i} \quad\text{for}\quad \xi\in(0,1)
      \end{equation}
      This process is repeated until the initial transition path for the aggregate capital stock is consistent with the transition path implied by those beliefs and household and firm optimization. TPI solves for the equilibrium transition path from Definition \ref{DefSperSimpNSSEql} by finding a fixed point in the time path of the economy.


   \subsection{Calibration}\label{SecSperSimpCalibr}

      Use the following parameterization of the model for the problems below. Assume that agents are born at age 21 and die at age 100 (80 years of life). Now your time dependent parameters can be written as functions of $S$, because each period of the model is $80/S$ years. If the annual discount factor is estimated to be 0.96, then the model period discount factor is $\beta = 0.96^{80/S}$. Assume initially that $S=80$. Let the annual depreciation rate of capital be 0.05. Then the model period depreciation rate is $\delta = 1-(1-0.05)^{80/S} = 0.05$. Let the coefficient of relative risk aversion be $\sigma = 3$, let the productivity scale parameter of firms be $A=1$, and let the capital share of income be $\alpha = 0.35$.


   \subsection{Exercises}\label{SecSperSimpEx}

      \begin{exercise} \label{ExSperSimp_SS}
         Using the calibration from Section \ref{SecSperSimpCalibr} and the steady-state equilibrium Definition \ref{DefSperSimpSSEql}, solve for the steady-state equilibrium values of $\{\bar{c}_s\}_{s=1}^S$, $\{\bar{b}_s\}_{s=2}^S$, $\bar{w}$, and $\bar{r}$ numerically. Make sure your code also works for $S=3$, $S=30$, and $S=60$.
      \end{exercise}

      \begin{exercise} \label{ExSperSimp_rho}
         What happens to each of these steady-state values if all households become more patient $\beta\uparrow$ (an example would be $\beta = 0.98$)? That is, in what direction does $\beta\uparrow$ move each steady-state value $\{\bar{c}_s\}_{s=1}^S$, $\{\bar{b}_s\}_{s=2}^S$, $\bar{w}$, and $\bar{r}$? What is the intuition?
      \end{exercise}

      \begin{exercise} \label{ExSperSimp_TPI}
         Use time path iteration (TPI) to solve for the non-steady state equilibrium transition path of the economy from $\bm{\Gamma}_1=(0.93\bm{\bar{\Gamma}}$ to the steady-state $\bm{\bar{\Gamma}}$. You'll have to choose a guess for $T$ and a time path updating parameter $\xi\in(0,1)$, but I can assure you that $T<200$. Use an $L^2$ norm for your distance measure (sum of squared percent deviations), and use a convergence parameter of $\ve = 10^{-9}$. Use a linear initial guess for the time path of the aggregate capital stock from the initial state $K_1^1$ to the steady state $K_T^1$ at time $T$.
      \end{exercise}

      \begin{exercise} \label{ExSperSimp_TPIplot}
         Plot the equilibrium time path of the aggregate capital stock $\{K_t\}_{t=1}^{T+5}$. How many periods did it take for the economy to get within 0.0001 of the steady-state aggregate capital stock $\bar{K}$? That is, what is $T$?
      \end{exercise}


\newpage
\section{\textit{S}-period-lived agents, exogenous labor, and stochastic ability}\label{SecSperStoch}

   In this section, we take the model from Section \ref{SecSperSimp} and add to it different ability types of agents as well as idiosyncratic shocks to individual's ability.


   \subsection{Households}\label{SecSperStochHH}

      Individuals are born at age $s=1$ and live to age $S\in[3,80]$. We choose 80 as the upper bound of periods to live so that the minimum amount of time represented by a model period is one year. But this restriction is not very important.

      At birth, each individual age $s=1$ is randomly assigned one of $J$ ability types $e_{j,t}\in\{e_1,e_2,...e_J\}$, indexed by $j$. Let the vector $\bm{\lambda}_t = [\lambda_{1,t},\lambda_{2,t},...\lambda_{J,t}]$ with typical element $\lambda_{j,t}$ represent the fraction of individuals in each ability group $j$, such that $\sum_j\lambda_{j,t}=1$ for all $t$. We are assuming that the distribution across ability types is the same within each age cohort. We now define a Markov transition matrix $\Pi(e_{k,t+1}|e_{j,t})$ that gives the probability of being ability type $e_{k,t+1}$ next period given that you are type $e_{j,t}$ today with $k,j\in\{1,2,...J\}$. The Markov process $\Pi$ is the following matrix of probabilities,
      \begin{equation}\label{EqMarkovTrans}
         \Pi(e_{k,t+1}|e_{j,t}) =
            \begin{bmatrix}
               \pi_{1,1} & \pi_{1,2} & \hdots & \pi_{1,J} \\
               \pi_{2,1} & \pi_{2,2} & \hdots & \pi_{2,J} \\
               \vdots    & \vdots    & \ddots & \vdots    \\
               \pi_{J,1} & \pi_{J,2} & \hdots & \pi_{J,J} \\
            \end{bmatrix}
      \end{equation}
      where the typical element of $\Pi(e_{k,t+1}|e_{j,t})$ is $\pi_{j,k}$, each element is strictly positive $\pi_{j,k}>0$ and each of the rows sums to one $\sum_{k=1}^J \pi_{j,k} = 1$. $\Pi$ is a stochastic matrix.

      We assume that the ability distribution $\bm{\lambda}_t = \bm{\bar{\lambda}}$ for all $t$ is identical across ages $s$ and across time periods $t$. This means that $\bm{\bar{\lambda}}$ is the ergodic distribution of the stochastic process $\Pi$. The population distribution across types $\bm{\lambda}_t$ evolves according to the following recursion.
      \begin{equation}\label{EqLambdaRec}
         \bm{\lambda}'_{t+1} = \Pi' \bm{\lambda}'_t \quad\Leftrightarrow\quad
         \begin{bmatrix}\lambda_{1,t+1} \\ \lambda_{2,t+1} \\ \vdots \\ \lambda_{J,t+1} \end{bmatrix} =
         \begin{bmatrix}
            \pi_{1,1} & \pi_{2,1} & \hdots & \pi_{J,1} \\
            \pi_{1,2} & \pi_{2,2} & \hdots & \pi_{J,2} \\
            \vdots    & \vdots    & \ddots & \vdots    \\
            \pi_{1,J} & \pi_{2,J} & \hdots & \pi_{J,J} \\
         \end{bmatrix}
         \begin{bmatrix}\lambda_{1,t} \\ \lambda_{2,t} \\ \vdots \\ \lambda_{J,t} \end{bmatrix}
      \end{equation}
      where the ``$\:'\:$'' represents the transpose of the vectors and matrices described previously. Let the ergodic distribution over ability types be $\bm{\bar{\lambda}}=[\bar{\lambda}_1,\bar{\lambda}_2,...\bar{\lambda}_J]$. The ergodic ability distribution $\bm{\bar{\lambda}}$ is the eigen vector associated with the unit eigenvalue such that,
      \begin{equation}\label{EqLamgdaErg}
         \bm{\bar{\lambda}}' = \Pi' \bm{\bar{\lambda}}'
      \end{equation}

      With these stochastic abilities, individuals in our model are heterogeneous along two dimensions---ability $j$ and age $s$. For this reason, each endogenous individual decision now has a subscript for ability $j$, age $s$, and the time period $t$. The household budget constraint is now the following,
      \begin{equation}\label{EqSperStochHHbc}
         \begin{split}
            c_{j,s,t} + b_{j,s+1,t+1} &= w_t e_{j,t}n_{j,s,t} + (1 + r_{t} - \delta)b_{j,s,t} \quad\forall j,s,t \\
            &\qquad\text{where}\quad b_{j,1,t},b_{j,S+1,t} = 0 \quad\forall j,t
         \end{split}
      \end{equation}

      To simplify this model, we still assume that labor is supplied inelastically. However, we change the setup slightly from Section \ref{SecSperSimpHH}. We assume that the individual supplies one unit of labor inelastically before retirement and then supplies 0.3 units of labor after retirement.
      \begin{equation}\label{EqSperStochHHlab}
         n_{j,s,t} =
            \begin{cases}
               1\quad\text{if}\quad\:\:\: s\leq \text{round}\left(\frac{2S}{3}\right) \\
               0.3\quad\text{if}\quad s> \text{round}\left(\frac{S}{3}\right)
            \end{cases} \quad\forall j,s,t
      \end{equation}
      We assume positive but reduced labor hours after retirement because the data reflect that and also because we want the ability transitions to still have some effect after retirement.

      Households choose lifetime consumption $\{c_{j,s,t+s-1}\}_{s=1}^S$ and savings $\{b_{j,s+1,t+s}\}_{s=1}^{S-1}$ to maximize lifetime utility,
      \begin{equation}\label{EqSperStochLifeUtil}
         \begin{split}
            &\max_{\{c_{j,s,t+s-1}\}_{s=1}^S,\{b_{j,s+1,t+s}\}_{s=1}^{S-1}}E\bigl[U_{j,s,t}\bigr] = E\Bigl[\sum_{u=0}^{S-s}\beta^u u\left(c_{j,s+u,t+u}\right)\Bigr] \quad\forall j,s,t \\
            &\quad\text{where}\quad u\left(c_{j,s,t}\right) \equiv\frac{(c_{j,s,t})^{1-\sigma} - 1}{1-\sigma} \\
            &\quad\text{and}\quad c_{j,s,t} = w_t e_{j,t}n_{s} + (1 + r_{t} - \delta)b_{j,s,t} - b_{j,s+1,t+1} \\
            &\quad\text{and}\quad b_{j,1,t},b_{j,S+1,t} = 0
         \end{split}
      \end{equation}
      where the expectations operator $E[\cdot]$ is present because individuals do not know what their ability will $e_{k,t+u}$ be in future periods $u>1$ of their lives.

      Substituting the budget constraints from \eqref{EqSperStochHHbc} into the lifetime utility function \eqref{EqSperStochLifeUtil} reduces the household of type $j$ lifetime decision problem to choosing $S-1$ savings amounts $\{b_{j,s+1,t+s}\}_{s=1}^{S-1}$. These $S-1$ decision variables are characterized by the following $S-1$ household first order conditions,
      \begin{equation}\label{EqSperStochfocbgen}
         u'\left(c_{j,s,t}\right) = \beta E\Bigl[\left(1 + r_{t+1}\right)u'\left(c_{j,s+1,t+1}\right)\Bigr] \quad\forall j,t,\quad 1\leq s\leq S-1
      \end{equation}
      where $c_{j,s,t}$ is defined in the budget constraint \eqref{EqSperStochHHbc}.

      We can characterize the complete set of optimal household decisions by backward induction from the last period of life. For this, we define a value function $V_s:\mathbb{R}^4\rightarrow\mathbb{R}$. The subscript $s$ means that there is a different value function for each age.
      \begin{equation}\label{EqSperStochVF}
         \begin{split}
            V_s\left(b_{j,s,t},e_{j,t},r_t,w_t\right) = &\max_{b_{k,s+1,t+1}} u\left(c_{j,s,t}\right) + ... \\
            &\quad\beta E_{e_{k,t+1}|e_{j,t}}\bigl[V_{s+1}\left(b_{k,s+1,t+1},e_{k,t+1},r_{t+1},w_{t+1}\right)\bigr]
         \end{split}
      \end{equation}

      In the last period of life $s=S$, the value function is simple.
      \begin{equation}\label{EqSperStochVFS}
         V_{S}\left(b_{j,S,t},e_{j,t},r_t,w_t\right) = \max_{b_{k,S+1,t+1}} u\left(c_{j,S,t}\right) = u\bigl(w_t e_{j,t}n_{S} + (1 + r_t)b_{j,s,t}\bigr)
      \end{equation}
      The solution is to set saving for the period after death to zero $b_{k,S+1,t+1}$ and the age-$S$ value function is $V_{S}\left(b_{j,S,t},e_{j,t},r_t,w_t\right) = u\bigl(w_t e_{j,t}n_{S} + (1 + r_t)b_{j,s,t}\bigr)$.
      In the second-to-last period of life $s=S-1$ the value function is the following.
      \begin{equation}\label{EqSperStochVFSm1a}
         \begin{split}
            V_{S-1}\left(b_{j,S-1,t},e_{j,t},r_t,w_t\right) = &\max_{b_{k,S,t+1}} u\left(c_{j,S-1,t}\right) + ... \\
            &\quad \beta E_{e_{k,t+1}|e_{j,t}}\bigl[V_{S}\left(b_{k,S,t+1},e_{k,t+1},r_{t+1},w_{t+1}\right)\bigr]
         \end{split}
      \end{equation}
      You have already solved for the value function in the last period of life $V_S$ from \eqref{EqSperStochVFS}. Because of the Markov process from \eqref{EqMarkovTrans}, the expectation on the right-hand-side of \eqref{EqSperStochVFSm1a} can be rewritten as the following.
      \begin{equation}\label{EqSperStochVFSm1b}
         \begin{split}
            V_{S-1}\left(b_{j,S-1,t},e_{j,t},r_t,w_t\right) = &\max_{b_{k,S,t+1}} u\left(c_{j,S-1,t}\right) + ... \\
            &\quad \beta \sum_{k=1}^J\pi_{j,k}V_S\left(b_{k,S,t+1},e_{k,t+1},r_{t+1},w_{t+1}\right)
         \end{split}
      \end{equation}

      Note that for any of the $j=\{1,2,...J\}$ ability levels $e_{j,t}$, and for a given current period wealth $b_{j,s,t}$, and for given time paths of prices $\{r_t,w_t,r_{t+1},w_{t+1}\}$, the value function is one equation and one unknown. The solution to \eqref{EqSperStochVFSm1a} is a policy function $b_{k,S,t+1}=\psi_{S-1}\left(b_{j,S-1,t},e_{j,t},w_t,r_t\right)$ and a value function $V_{S-1}\left(b_{j,S-1,t},e_{j,t},r_t,w_t\right)$. Successively solving the households lifetime decisions and value functions by backward induction using the finite recursion \eqref{EqSperStochVF} gives the full set of policy functions for that household.
      \begin{equation}\label{EqSperStochHHPF}
         b_{k,s+1,t+1} = \psi_s\bigl(b_{j,s,t},e_{j,t},r_t,w_t\bigr) \quad\forall j,t \quad\text{and}\quad 1\leq s\leq S-1
      \end{equation}
      Each policy function in \eqref{EqSperStochHHPF} is characterized by an Euler equation. The lifetime set of optimal policy functions could also be solved for by backward induction using the Euler equations.
      \begin{equation}\label{EqSperStochEulGen}
         u'\left(c_{j,s,t}\right) = \beta E_{e_{k,t+1},e_{j,t}}\Bigl[(1 + r_{t+1})u'\bigl(c_{k,s+1,t+1}\bigr)\Bigr] \quad\forall j,t,\quad\text{and}\quad 1\leq s\leq S-1
      \end{equation}

      To conclude the household's problem, we must make an assumption about how the age-$s$ household can forecast the time path of interest rates and wages $\{r_u, w_u\}_{u=t}^{t+S-s}$ over his remaining lifetime. As we will show in Section \ref{SecSperStochEqlb}, the equilibrium interest rate $r_t$ and wage $w_t$ will be functions of the state vector $\bm{\Gamma}_t$, which turns out to be the entire distribution of savings at in period $t$.

      Define $\bm{\Gamma}_t$ as the distribution of household savings across households at time $t$.
      \begin{equation}\label{EqSperStochsavDist}
         \bm{\Gamma}_t \equiv \bigl\{\{b_{j,s,t}\}_{s=2}^S\bigr\}_{j=1}^J \quad\forall t
      \end{equation}
      Let general beliefs about the future distribution of capital in period $t+u$ be characterized by the operator $\Omega(\cdot)$ such that:
      \begin{equation}\tag{\ref{EqBeliefs}}
         \bm{\Gamma}^e_{t+u} = \Omega^u\left(\bm{\Gamma}_t\right) \quad \forall t, \quad u\geq 1
      \end{equation}
      where the $e$ superscript signifies that $\bm{\Gamma}^e_{t+u}$ is the expected distribution of wealth at time $t+u$ based on general beliefs $\Omega(\cdot)$ that are not constrained to be correct.\footnote{In Section \ref{SecSperSimpEqlb} we will assume that beliefs are correct (rational expectations) for the non-steady-state equilibrium in Definition \ref{DefSperSimpNSSEql}.}


   \subsection{Firms}\label{SecSperStochFirms}

      The production side of this economy is identical to the one in Section \ref{Sec3perSimpFirms} with a unit measure of identical, perfectly competitive firms that rent investment capital from individuals for real return $r_t$ and hire labor for real wage $w_t$. Firms use their total capital $K_t$ and labor $L_t$ to produce output $Y_t$ every period according to a Cobb-Douglas production technology,
      \begin{equation}\tag{\ref{EqFirmProdFunc}}
         Y_t = F(K_t,L_t) \equiv AK_t^\alpha L_t^{1-\alpha}\quad\text{where}\quad \alpha\in(0,1) \quad\text{and}\quad A>0.
      \end{equation}
      The representative firm chooses how much capital to rent and how much labor to hire to maximize profits,
      \begin{equation}\tag{\ref{EqFirmProfMax}}
         \max_{K_t,L_t}\: AK_t^\alpha L_t^{1-\alpha} - (r_t + \delta)K_t - w_t L_t
      \end{equation}
      where $\delta\in[0,1]$ is the rate of capital depreciation, and the two first order conditions that characterize firm optimization are the following.
      \begin{align}
         r_t &= \alpha A\left(\frac{L_t}{K_t}\right)^{1-\alpha} - \delta \tag{\ref{EqFirmFOCK}} \\
         w_t &= (1-\alpha)A\left(\frac{K_t}{L_t}\right)^\alpha \tag{\ref{EqFirmFOCL}}
      \end{align}

      The only change to note, which is described more carefully in Section \ref{SecSperStochMC} in the labor market clearing condition \eqref{EqSperStochMktClrLab}, is that aggregate labor $L_t$ in the production function is now in efficiency units. This means that the aggregate labor $L_t$ used in production is made up of both labor hours $n_{s}$ and ability $e_{j,t}$.


   \subsection{Market clearing}\label{SecSperStochMC}

      The market clearing conditions for this version of the model slightly different from those in the previous sections because we must sum not only over ages $s$ but also over ability types $j$. The labor market, capital market, and goods market must clear.
      \begin{align}
         L_t &= \sum_{s=1}^{S}\sum_{j=1}^{J} \bar{\lambda}_{j}e_{j,t}n_{s} \quad \forall t \label{EqSperStochMktClrLab} \\
         K_t &= \sum_{s=2}^{S}\sum_{j=1}^{J}\bar{\lambda}_{j}b_{j,s,t}  \quad \forall t \label{EqSperStochMktClrCap} \\
         \begin{split}
            Y_t &= C_t + K_{t+1} - (1-\delta)K_t \quad\forall t \\
            &\quad\text{where}\quad C_t \equiv \sum_{s=1}^{S}\sum_{j=1}^{J}\bar{\lambda}_{j}c_{j,s,t}
         \end{split} \label{EqSperStochMktClrGoods}
      \end{align}
      As noted in Section \ref{SecSperStochFirms}, the aggregate labor in the production function \eqref{EqFirmProdFunc} and in \eqref{EqSperStochMktClrLab} is in efficiency units (i.e., $L_t$ sums over $e_{j,t}n_{s}$). The goods market clearing equation \eqref{EqSperStochMktClrGoods} is redundant by Walra's Law.


   \subsection{Equilibrium}\label{SecSperStochEqlb}

      The definition of steady-state equilibrium in this model with $S$-period lived agents, exogenous labor supply, and stochastic ability is very similar to Definition \ref{DefSperSimpSSEql} in Section \ref{SecSperSimpEqlb}. But in this case, we have to solve for $J$ times the number of steady-state variables using $J$ times the number of first order conditions. And the characterizing Euler equations are have expectations in them, so this is a stochastic steady state.

      \end{spacing}
      \vspace{5mm}
      \hrule
      \vspace{-1mm}
      \begin{definition}[\textbf{Stochastic steady-state equilibrium}]\label{DefSperStochSSEql}
         A non-autarkic stochastic steady-state equilibrium in the overlapping generations model with $S$-period lived agents, exogenous labor supply, and stochastic ability is defined as constant allocations of savings $\bigl\{\{\bar{b}_{j,s}\}_{s=2}^S\bigr\}_{j=1}^J$, and prices $\bar{w}$ and $\bar{r}$ such that:
         \begin{enumerate}
            \item households optimize according to $J\times(S-1)$ dynamic savings Euler equations \eqref{EqSperStochEulGen},
            \item firms optimize according to \eqref{EqFirmFOCK} and \eqref{EqFirmFOCL},
            \item markets clear according to \eqref{EqSperStochMktClrLab} and \eqref{EqSperStochMktClrCap}.
         \end{enumerate}
      \end{definition}
      \vspace{-2mm}
      \hrule
      \vspace{5mm}
      \begin{spacing}{1.5}

      The steady-state version of the system of $J\times(S-1)$ Euler equations is the following.
      \begin{equation}\label{EqSperStochEulSSa}
         \begin{split}
            &\bigl(\bar{w}e_{j}n_{s} + (1+\bar{r})\bar{b}_{j,s} - \bar{b}_{j,s+1}\bigr)^{-\sigma} = ... \\
            &\qquad \beta(1+\bar{r})E_{e_k|e_j}\Bigl[\bigl(\bar{w}e_{k}n_{s+1} + (1+\bar{r})\bar{b}_{k,s+1} - \bar{b}_{k,s+2}\bigr)^{-\sigma}\Bigr] \\
            &\qquad\qquad\qquad\forall j \quad\text{and}\quad 1\leq s\leq S-1
         \end{split}
      \end{equation}
      Breaking out the expectation term in terms of the transition matrix $\Pi$ elements gives the following steady-state characterization.
      \begin{equation}\label{EqSperStochEulSSb}
         \begin{split}
            &\bigl(\bar{w}e_{j}n_{s} + (1+\bar{r})\bar{b}_{j,s} - \bar{b}_{j,s+1}\bigr)^{-\sigma} = ... \\
            &\qquad \beta(1+\bar{r})\sum_{k=1}^J\pi_{j,k}\Bigl[\bigl(\bar{w}e_{k}n_{s+1} + (1+\bar{r})\bar{b}_{k,s+1} - \bar{b}_{k,s+2}\bigr)^{-\sigma}\Bigr] \\
            &\qquad\qquad\qquad\forall j \quad\text{and}\quad 1\leq s\leq S-1
         \end{split}
      \end{equation}
      The steady state is the constant distribution of savings $\bm{\bar{\Gamma}}=\bigl\{\{\bar{b}_{j,s}\}_{s=2}^S\bigr\}_{j=1}^J$ that solves the stochastic system of $J\times(S-1)$ nonlinear dynamic equations, given that $\bar{r}$ and $\bar{w}$ are also just functions of the steady-state distribution of savings.

      The non-steady-state equilibrium for this model is a set of stationary policy functions of the state that satisfy household optimization, firm optimization, market clearing, and rational expectations.

      \end{spacing}
      \vspace{5mm}
      \hrule
      \vspace{-1mm}
      \begin{definition}[\textbf{Non-steady-state functional equilibrium}]\label{DefSperStochNSSEql}
         A non-steady-state functional equilibrium in the overlapping generations model with $S$-period lived agents, exogenous labor supply, and stochastic ability is defined as stationary allocation functions of the state for capital $\Bigl\{\bigl\{\psi_{j,s}\bigl(\bm{\Gamma}_t\bigr)\bigr\}_{s=1}^{S-1}\Bigr\}_{j=1}^J$ and stationary price functions $w(\bm{\Gamma}_t)$ and $r(\bm{\Gamma}_t)$ such that:
         \begin{enumerate}
            \item households have symmetric beliefs $\Omega(\cdot)$ about the evolution of the distribution of savings as characterized in \eqref{EqBeliefs}, and those beliefs about the future distribution of savings equal the realized outcome (rational expectations),
               \begin{equation*}
                  \bm{\Gamma}_{t+u} = \bm{\Gamma}^e_{t+u} = \Omega^u\left(\bm{\Gamma}_t\right) \quad\forall t,\quad u\geq 1
               \end{equation*}
            \item households optimize according to $J\times(S-1)$ dynamic savings Euler equations \eqref{EqSperStochEulGen},
            \item firms optimize according to \eqref{EqFirmFOCK} and \eqref{EqFirmFOCL},
            \item markets clear according to \eqref{EqSperStochMktClrLab} and \eqref{EqSperStochMktClrCap}.
         \end{enumerate}
      \end{definition}
      \vspace{-2mm}
      \hrule
      \vspace{5mm}
      \begin{spacing}{1.5}

      Solving for the non-steady-state equilibrium policy functions in this model can be done with either a backwards induction value function method or a backwards induction policy function method. Both methods will give the same answer. In the next section, we detail the backwards induction policy function method, because that method gives the decentralized equilibrium solution when taxes and corresponding distortions are introduced. The backwards induction value function method gives the centralized or planner's solution.


   \subsection{Solution method: time path iteration (TPI)}\label{SecSperStochTPI}

      The TPI solution method for the non-steady-state equilibrium time path for the $S$-period-lived agent model with exogenous labor and stochastic ability is similar to the method described in Section \ref{Sec3perLabTPI} in that you only need to choose and iterate on an initial guess of the time path of the aggregate capital stock $\bm{K}^i = \left\{K_1^i,K_2^i,...K_T^i\right\}$. But the problem is different because there are so many more first order conditions due to each age group having $J$ different ability types and due to each lifetime set of policy functions is solved by the backward induction policy function method.

      Choose an initial guess for the time path of aggregate capital $\bm{K}^i$. This time path implies time paths for the real wage $\bm{w}^i$ and real interest rate $\bm{r}^i$. Given the guesses for the time paths of the real wage and real interest rate, as well as the initial distribution of savings $\bm{\Gamma}_1$ consistent with the initial aggregate capital stock $K_1^i$, we can solve for the remaining lifetime decisions of each individual alive between periods 1 and $T$ using the $J(2S-1)$ first order conditions characterized in \eqref{EqSperStochEulGen} by the backward induction policy function method.

      Once we have solved all the sets of individual lifetime policy functions for individuals alive between periods 1 and $T$, we can compute the implied new time path for aggregate capital $\bm{K}^{i'}$. Use the norm in \eqref{EqEqlTPIdist} to check whether the initial guess for the time paths $\bm{K}^{i}$ is close enough to the time paths implied by the initial guess and individual optimization $\bm{K}^{i'}$. If the convergence criterion \eqref{EqEqlTPIdist} is satisfied, the equilibrium time path has been computed by finding the fixed point in the time path. If the criterion is not satisfied, then update the time paths according to \eqref{EqEqlTPInewpath}.

      This process is repeated until the initial transition path for aggregate capital is consistent with the transition path implied by those beliefs and household and firm optimization. TPI solves for the equilibrium transition path from Definition \ref{DefSperStochNSSEql} by finding a fixed point in the time path of the economy.

      We now present an exposition of the backward induction policy function solution method for the $S-1$ policy functions of an individual's lifetime. Begin by solving the second-to-last period of life $s=S-1$ policy function for the $J$ individuals who are age $s=S-1$ in period 1. We have guessed the time path of the aggregate capital stock $\bm{K}^{i}$, so we know the time paths for the interest rate $\bm{r}^i$ and real wage $\bm{w}^i$. We also know the entire initial distribution of savings $\bm{\Gamma}_1$. The household's problem is shown in \eqref{EqSperStochVFSm1b}. The Euler equation from that problem, which characterizes the policy function $b_{j,S,2}=\psi_{j,S-1}\left(b_{j,S-1,1},e_{j,1},r_1,w_1\right)$ is the following,
      \begin{equation}\label{EqSperStochEulSm1t1}
         \begin{split}
            &\bigl(w_1^{i}e_{j,1}n_{S-1} + (1+r_1^i)b_{j,S-1,1} - b_{j,S,2}\bigr)^{-\sigma} = ... \\
            &\qquad \beta (1+r_2^i)\sum_{k=1}^J\pi_{j,k}\Bigl[\bigl(w_2^{i}e_{k,2}n_{S} + (1+r_2^i)b_{j,S,2}\bigr)^{-\sigma}\Bigr] \quad\forall j
         \end{split}
      \end{equation}

      Because we know the interest rates, wages, and initial savings $b_{j,S-1,1}$, we just need to solve the policy function for all possible values of period $1$ ability types $e_{j,1}$. Further, each one of the $J$ values of $e_{j,1}$ corresponds one-to-one with the appropriate $b_{j,S-1,1}$ in the initial savings distribution $\bm{\Gamma}_1$. We therefore only have to solve for $J$ versions of the Euler equation \eqref{EqSperStochEulSm1t1}, where $b_{j,S,2}=\psi_{j,S-1,1}\left(b_{j,S-1,1},e_{j}\right)$. We do this by solving $b_{j,S,2}=\psi_{j,S-1,1}\left(e_{j,1}\right)$ for each of the $J$ combinations of $\left(b_{j,S-1,1},e_{j,1}\right)$.\footnote{Note that here we have added a third $t=1$ subscript to the policy function $\psi_{j,s,t}$. This is because we have removed $r_t$ and $w_t$ from the function. So each function is now dependent on the relevant segment of the time path of $\bm{r}^i$ and $\bm{w}^i$. In other words, $\psi_{j,s,t}\neq\psi_{j,s,u}$ for $t\neq u$, in general.}

      Think of $\psi_{j,S-1,1}\left(b_{j,S-1,1},e_{j,1}\right)$ as a vector that has as many columns ($J$) as their are points in the support of $e_{j,1}$. For a given element of that vector, the Euler equation \eqref{EqSperStochEulSm1t1} is one equation and one unknown. The solution is the $j$-th element of the discretized policy function vector $\psi_{j,S-1,1}$. To find all the elements of the vector, we must loop through each column, solving the appropriate one equation and one unknown from \eqref{EqSperStochEulSm1t1}.

      %Because we know the interest rates and wages, we just need to solve the policy function for all possible values of individual savings $b_{j,S-1,1}$ and period $t-1$ ability types $e_{j,1}$. We do this by solving $b_{j,S,2}=\psi_{j,S-1}\left(b_{j,S-1,1},e_{j,1}\right)$ on a grid over $\left(b_{j,S-1,1},e_{j,1}\right)$. Obvious values for the support of $e_{j,1}$ would be $\{e_1,e_2,...e_j\}$. For values of $b_{j,S-1,1}$, choosing the discretized support is a little more of an art. You want to make sure that you have a high enough upper bound, and a low enough lower bound, and enough points in between $\{b_{min},b_2,...b_{max}\}$. However, the computation time becomes pretty costly the more points you have, so you want to also be as parsimonious as possible.

      %Think of $\psi_{j,S-1}\left(b_{j,S-1,1},e_{j,1}\right)$ as a matrix that has as many rows as their are points in the support of $b_{j,S-1,1}$ and as many columns ($J$) as their are points in the support of $e_{j,1}$. For a given element of that matrix $(b_b,e_j)$, the Euler equation \eqref{EqSperStochEulSm1} is one equation and one unknown. The solution is the $(b,j)$-th element of the discretized policy function matrix $\psi_{j,S-1}$. To find all the elements to the matrix, we must loop through each row and column, solving the appropriate one equation and one unknown from \eqref{EqSperStochEulSm1}. We solve this entire matrix for each of the $J$ individuals age $s=S-1$ in period 1.

      For the $J$ individuals who are age $s=S-2$ in period 1, they each have two policy functions for which we must solve. We start with their final decision which takes place in period $t=2$. It is similar to the decision of the age $s=S-1$ individual in period 1 in \eqref{EqSperStochEulSm1t1}. However, for this decision, we do not know the initial wealth in period 2 $b_{j,S-1,2}$ and we do not know what the realization of the ability shock $e_{j,2}$ will be. This wealth will be the policy function chosen in period 1. The age $s=S-1$ policy functions in period 2 must, therefore, be functions of both the initial wealth $b_{j,S-1,2}$ as well as the realized ability level in that period $e_{j,2}$.
      \begin{equation}\label{EqSperStochEulSm1t2}
         \begin{split}
            &\bigl(w_2^{i}e_{j,2}n_{S-1} + (1+r_2^i)b_{j,S-1,2} - b_{j,S,3}\bigr)^{-\sigma} = ... \\
            &\qquad \beta (1+r_3^i)\sum_{k=1}^J\pi_{j,k}\Bigl[\bigl(w_3^{i}e_{k,3}n_{S} + (1+r_3^i)b_{j,S,3}\bigr)^{-\sigma}\Bigr] \quad\forall j
         \end{split}
      \end{equation}

      Because we know the interest rates and wages, we just need to solve the policy function for all possible values of individual savings $b_{j,S-1,2}$ and period $2$ ability types $e_{j,2}$. We do this by solving $b_{j,S,3}=\psi_{j,S-1,2}\left(b_{j,S-1,2},e_{j,2}\right)$ on a grid over $\left(b_{j,S-1,2},e_{j,2}\right)$. Obvious values for the support of $e_{j,2}$ are $\{e_1,e_2,...e_j\}$. For values of $b_{j,S-1,2}$, choosing the discretized support is a little more of an art. You want to make sure that you have a high enough upper bound, and a low enough lower bound, and enough points in between $\{b_{min},b_2,...b_{max}\}$. However, the computation time becomes pretty costly the more points you have, so you want to also be as parsimonious as possible.

      Think of $\psi_{j,S-1,2}\left(b_{j,S-1,2},e_{j,2}\right)$ as a matrix that has as many rows as their are points in the support of $b_{j,S-1,2}$ and as many columns ($J$) as their are points in the support of $e_{j,2}$. For a given element of that matrix $(b_b,e_j)$, the Euler equation \eqref{EqSperStochEulSm1t2} is one equation and one unknown. The solution is the $(b,j)$-th element of the discretized policy function matrix $\psi_{j,S-1,2}$. To find all the elements to the matrix, we must loop through each row and column, solving the appropriate one equation and one unknown from \eqref{EqSperStochEulSm1t2}. We solve this entire matrix for each of the $J$ individuals age $s=S-1$ in period 2.

      With a solution for the second-to-last period of life $b_{j,S,3}=\psi_{j,S-1,2}\left(b_{j,S-1,2},e_{j,2}\right)$, we can now solve each of these same $J$ individuals' period-1 problem of how much to save $b_{j,S-1,2}$. The Euler equation characterizing this decision is the following.
      \begin{equation}\label{EqSperStochEulSm2t1a}
         \begin{split}
            &\bigl(w_1^{i}e_{j,1}n_{S-2} + (1+r_1^i)b_{j,S-2,1} - b_{j,S-1,2}\bigr)^{-\sigma} = ... \\
            &\qquad \beta (1+r_2^i)\sum_{k=1}^J\pi_{j,k}\Bigl[\bigl(w_2^{i}e_{k,2}n_{S-1} + (1+r_2^i)b_{j,S-1,2} - b_{k,S,3}\bigr)^{-\sigma}\Bigr] \quad\forall j
         \end{split}
      \end{equation}
      We can replace $b_{k,S,3}$ in the bracketed term in \eqref{EqSperStochEulSm2t1a} with its policy function $\psi_{j,S-1,2}\left(b_{j,S-1,2},e_{j,2}\right)$ derived from \eqref{EqSperStochEulSm1t2}.
      \begin{equation}\label{EqSperStochEulSm2t1b}
         \begin{split}
            &\bigl(w_1^{i}e_{j,1}n_{S-2} + (1+r_1^i)b_{j,S-2,1} - b_{j,S-1,2}\bigr)^{-\sigma} = ... \\
            &\qquad \beta (1+r_2^i)\sum_{k=1}^J\pi_{j,k}\Bigl[\bigl(w_2^{i}e_{k,2}n_{S-1} + (1+r_2^i)b_{j,S-1,2} - \psi_{k,S-1,2}\left(b_{j,S-1,2},e_{k,2}\right)\bigr)^{-\sigma}\Bigr] \quad\forall j
         \end{split}
      \end{equation}
      For this set of $J$ policy functions $b_{j,S-1,2}=\psi_{j,S-2,1}\left(b_{j,S-2,1},e_{j,1}\right)$, each of the $J$ individuals with different abilities has a known savings level $b_{j,S-2,1}$ from the initial distribution of wealth $\bm{\Gamma}_1$. So we must only solve for $J$ versions of this policy function, with each version being a scalar.

      This process is repeated for each individual alive between periods 1 and $T$. The last $S-2$ policy functions are represented as matrices in terms of current wealth and ability. And the first policy function is a scalar because the initial wealth and initial ability are known.



   % \subsection{Calibration}\label{SecSabilCalibr}

   %    Use the following parameterization of the model for the problems below. Let agents live for $S=80$ periods, which implies that each model period of life is one year. The annual discount factor is estimated to be 0.96, so the discount factor per period in the $S$-period model should be $\beta = 0.96^{80/S} = 0.96$. Let the annual depreciation rate of capital be 0.05. Then the depreciation rate in the $S$-period model should be $\delta = 1-(1-0.05)^{80/S} = 0.05$. Let the coefficient of relative risk aversion be $\sigma = 3$, let the productivity scale parameter of firms be $A=1$, and let the capital share of income be $\alpha = 0.35$. For the disutility of labor, let $\chi^n=1$, and let $[b,k,\upsilon] = [.6701,-.6548,1.3499]$. Assume $J=7$ ability types with percentages $\{\lambda_j\}_{j=1}^7 = [0.25,0.25,0.20,0.10,0.10,0.09,0.01]$. Import the comma delimited data file \texttt{e\_js.txt} as a numpy array, which is the data for the $80\times 7$ matrix of ability levels $e_{j,s}$, as described in Exercise \ref{ExSabilEjs}.


   \subsection{Exercises}\label{SecSperStochEx}

      \renewcommand\theenumi{\alph{enumi}}
      \begin{exercise}\label{ExSperStochPi2}
         Solve for steady-state and time path for the following simple problem with $S=3$ and $J=2$, with the following transition matrix $\Pi$,
         \begin{equation*}
            \Pi = \begin{bmatrix}
                     \pi_{1,1} & \pi_{1,2} \\
                     \pi_{2,1} & \pi_{2,2}
                  \end{bmatrix} =
                  \begin{bmatrix}
                     0.6 & 0.4 \\
                     0.4 & 0.6
                  \end{bmatrix}
         \end{equation*}
         with possible abilities being $e_{j,t}\in\{e_1,e_2\}=\{0.8,1.2\}$.
      \end{exercise}

      \begin{exercise}\label{ExSperStochPi7}
         Solve for steady-state and time path for the following large problem with $S=80$ and $J=7$, with the following transition matrix $\Pi$,
         \begin{equation*}
            \Pi = \begin{bmatrix}
                     \pi_{1,1} & \pi_{1,2} & \hdots & \pi_{1,7} \\
                     \pi_{2,1} & \pi_{2,2} & \hdots & \pi_{2,7} \\
                     \vdots    & \vdots    & \ddots & \vdots    \\
                     \pi_{7,1} & \pi_{7,2} & \hdots & \pi_{7,7} \\
                  \end{bmatrix} =
                  \begin{bmatrix}
                     0.40 & 0.30 & 0.24 & 0.18 & 0.14 & 0.10 & 0.06 \\
                     0.30 & 0.40 & 0.30 & 0.24 & 0.18 & 0.14 & 0.10 \\
                     0.24 & 0.30 & 0.40 & 0.30 & 0.24 & 0.18 & 0.14 \\
                     0.18 & 0.24 & 0.30 & 0.40 & 0.30 & 0.24 & 0.18 \\
                     0.14 & 0.18 & 0.24 & 0.30 & 0.40 & 0.30 & 0.24 \\
                     0.10 & 0.14 & 0.18 & 0.24 & 0.30 & 0.40 & 0.30 \\
                     0.06 & 0.10 & 0.14 & 0.18 & 0.24 & 0.30 & 0.40
                  \end{bmatrix}
         \end{equation*}
         with possible abilities being $e_{j,t}\in\{e_1,e_2, ...e_7\}=\{0.6, 0.8, 1.0, 1.3, 1.6, 2.0, 2.5\}$.
      \end{exercise}

   %    \begin{exercise} \label{ExSabil_SS}
   %       Using the calibration from Section \ref{SecSabilCalibr} and the steady-state equilibrium Definition \ref{DefSabilSSEql}, solve for the steady-state equilibrium values of $\bigl\{\{\bar{c}_{j,s}\}_{s=1}^S\bigr\}_{j=1}^J$, $\bigl\{\{\bar{n}_{j,s}\}_{s=1}^S\bigl\}_{j=1}^J$, $\bigl\{\{\bar{b}_{j,s}\}_{s=2}^S\bigr\}_{j=1}^J$, $\bar{w}$, and $\bar{r}$ numerically. [Hint: Choose an initial guess that is feasible. This is harder when including the $J$ dimension. I would suggest low savings (close to zero) and high labor supply (close to 1).]
   %    \end{exercise}

   %    \begin{exercise} \label{ExSabil_TPI}
   %       Use time path iteration (TPI) to solve for the non-steady state equilibrium transition path of the economy from $\bm{\Gamma}_1=0.9\bar{\bm{\Gamma}}$ to the steady-state $\bar{\bm{\Gamma}}$. You'll have to choose a guess for $T$ and a time path updating parameter $\xi\in(0,1)$, but I can assure you that $T<160$. Use an $L^2$ norm for your distance measure (sum of squared percent deviations), and use a convergence parameter of $\ve = 10^{-9}$. Use a linear initial guess for the time path of the aggregate capital stock from the initial state $K_1^1$ to the steady state $K_T^1$ at time $T$.
   %    \end{exercise}

   %    \begin{exercise} \label{ExSabil_TPIplot}
   %       Plot the equilibrium time paths of the aggregate capital stock $\{K_t\}_{t=1}^{T+10}$ and aggregate labor $\{L_t\}_{t=1}^{T+10}$. How many periods did it take for the economy to get within 0.0001 of the steady-state aggregate capital stock $\bar{K}$? That is, what is $T$?
   %    \end{exercise}
   %    \renewcommand\theenumi{\roman{enumi}}


\end{spacing}

\newpage
\bibliography{OGstochinc}


\end{document}
